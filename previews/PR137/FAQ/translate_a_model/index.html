<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>I want to use PlantSimEngine for my model · PlantSimEngine.jl</title><meta name="title" content="I want to use PlantSimEngine for my model · PlantSimEngine.jl"/><meta property="og:title" content="I want to use PlantSimEngine for my model · PlantSimEngine.jl"/><meta property="twitter:title" content="I want to use PlantSimEngine for my model · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/FAQ/translate_a_model/"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/FAQ/translate_a_model/"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/FAQ/translate_a_model/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/why_plantsimengine/">Why PlantSimEngine ?</a></li><li><a class="tocitem" href="../../introduction/why_julia/">Why Julia ?</a></li></ul></li><li><span class="tocitem">Prerequisites</span><ul><li><a class="tocitem" href="../../prerequisites/installing_plantsimengine/">Installing and running PlantSimEngine</a></li><li><a class="tocitem" href="../../prerequisites/key_concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../prerequisites/julia_basics/">Julia language basics</a></li></ul></li><li><span class="tocitem">Step by step - Single-scale simulations</span><ul><li><a class="tocitem" href="../../step_by_step/detailed_first_example/">Detailed first simulation</a></li><li><a class="tocitem" href="../../step_by_step/simple_model_coupling/">Coupling</a></li><li><a class="tocitem" href="../../step_by_step/model_switching/">Model Switching</a></li><li><a class="tocitem" href="../../step_by_step/quick_and_dirty_examples/">Quick examples</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_process/">Implementing a process</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model/">Implementing a model</a></li><li><a class="tocitem" href="../../step_by_step/parallelization/">Parallelization</a></li><li><a class="tocitem" href="../../step_by_step/advanced_coupling/">Advanced coupling and hard dependencies</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model_additional/">Implementing a model : additional notes</a></li></ul></li><li><a class="tocitem" href="../../model_execution/">Execution</a></li><li><span class="tocitem">Working with data</span><ul><li><a class="tocitem" href="../../working_with_data/reducing_dof/">Reducing DoF</a></li><li><a class="tocitem" href="../../working_with_data/fitting/">Fitting</a></li><li><a class="tocitem" href="../../working_with_data/inputs/">Input types</a></li><li><a class="tocitem" href="../../working_with_data/visualising_outputs/">Visualizing outputs and data</a></li><li><a class="tocitem" href="../../working_with_data/floating_point_accumulation_error/">Floating-point considerations</a></li></ul></li><li><span class="tocitem">Moving to multiscale</span><ul><li><a class="tocitem" href="../../multiscale/multiscale_considerations/">Multiscale considerations</a></li><li><a class="tocitem" href="../../multiscale/single_to_multiscale/">Converting a simulation to multi-scale</a></li><li><a class="tocitem" href="../../multiscale/multiscale/">More variable mapping examples</a></li><li><a class="tocitem" href="../../multiscale/multiscale_cyclic/">Handling cyclic dependencies</a></li><li><a class="tocitem" href="../../multiscale/multiscale_coupling/">Multiscale coupling considerations</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">Building a simple plant</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../multiscale/multiscale_example_1/">A rudimentary plant simulation</a></li><li><a class="tocitem" href="../../multiscale/multiscale_example_2/">Expanding the plant simulation</a></li><li><a class="tocitem" href="../../multiscale/multiscale_example_3/">Fixing bugs in the plant simulation</a></li></ul></li><li><a class="tocitem" href="../../multiscale/multiscale_example_4/">Visualizing our toy plant with PlantGeom</a></li></ul></li><li><span class="tocitem">Troubleshooting and testing</span><ul><li><a class="tocitem" href="../../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/downstream_tests/">Automated testing</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/tips_and_workarounds/">Tips and Workarounds</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/implicit_contracts/">Implicit contracts</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/API_public/">Public API</a></li><li><a class="tocitem" href="../../API/API_examples/">Example models</a></li><li><a class="tocitem" href="../../API/API_private/">Internal API</a></li></ul></li><li><a class="tocitem" href="../../documentation_improvement/">Improving our documentation</a></li><li><a class="tocitem" href="../../developers/">Developer guidelines</a></li><li><a class="tocitem" href="../../planned_features/">Planned features</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>I want to use PlantSimEngine for my model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>I want to use PlantSimEngine for my model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs/src/FAQ/translate_a_model.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="I-want-to-use-PlantSimEngine-for-my-model"><a class="docs-heading-anchor" href="#I-want-to-use-PlantSimEngine-for-my-model">I want to use PlantSimEngine for my model</a><a id="I-want-to-use-PlantSimEngine-for-my-model-1"></a><a class="docs-heading-anchor-permalink" href="#I-want-to-use-PlantSimEngine-for-my-model" title="Permalink"></a></h1><p>If you already have a model, you can easily use <code>PlantSimEngine</code> to couple it with other models with minor adjustments.</p><h2 id="Toy-LAI-Model"><a class="docs-heading-anchor" href="#Toy-LAI-Model">Toy LAI Model</a><a id="Toy-LAI-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Toy-LAI-Model" title="Permalink"></a></h2><h3 id="Model-description"><a class="docs-heading-anchor" href="#Model-description">Model description</a><a id="Model-description-1"></a><a class="docs-heading-anchor-permalink" href="#Model-description" title="Permalink"></a></h3><p>Let&#39;s take an example with a simple LAI model that we define below:</p><pre><code class="language-julia hljs">&quot;&quot;&quot;
Simulate leaf area index (LAI, m² m⁻²) for a crop based on the amount of degree-days since sowing with a simple double-logistic function.

# Arguments

- `TT_cu`: degree-days since sowing
- `max_lai=8`: Maximum value for LAI
- `dd_incslope=500`: degree-days at which we get the maximal increase in LAI
- `inc_slope=5`: slope of the increasing part of the LAI curve
- `dd_decslope=1000`: degree-days at which we get the maximal decrease in LAI
- `dec_slope=2`: slope of the decreasing part of the LAI curve
&quot;&quot;&quot;
function lai_toymodel(TT_cu; max_lai=8.0, dd_incslope=500, inc_slope=70, dd_decslope=1000, dec_slope=20)
    LAI = max_lai * (1 / (1 + exp((dd_incslope - TT_cu) / inc_slope)) - 1 / (1 + exp((dd_decslope - TT_cu) / dec_slope)))
    if LAI &lt; 0
        LAI = 0
    end
    return LAI
end</code></pre><p>This model takes the number of days since sowing as input and returns the simulated LAI. We can plot the simulated LAI for a year:</p><pre><code class="language-julia hljs">using CairoMakie

lines(1:1300, lai_toymodel.(1:1300), color=:green, axis=(ylabel=&quot;LAI (m² m⁻²)&quot;, xlabel=&quot;Days since sowing&quot;))</code></pre><img src="aa399c67.png" alt="Example block output"/><h3 id="Changes-for-PlantSimEngine"><a class="docs-heading-anchor" href="#Changes-for-PlantSimEngine">Changes for PlantSimEngine</a><a id="Changes-for-PlantSimEngine-1"></a><a class="docs-heading-anchor-permalink" href="#Changes-for-PlantSimEngine" title="Permalink"></a></h3><p>The model can be implemented using <code>PlantSimEngine</code> as follows:</p><h4 id="Define-a-process"><a class="docs-heading-anchor" href="#Define-a-process">Define a process</a><a id="Define-a-process-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-process" title="Permalink"></a></h4><p>If the process of LAI dynamic is not implemented yet, we can define it like so:</p><pre><code class="language-julia hljs">@process LAI_Dynamic</code></pre><h4 id="Define-the-model"><a class="docs-heading-anchor" href="#Define-the-model">Define the model</a><a id="Define-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-model" title="Permalink"></a></h4><p>We have to define a structure for our model that will contain the parameters of the model:</p><pre><code class="language-julia hljs">struct ToyLAIModel &lt;: AbstractLai_DynamicModel
    max_lai::Float64
    dd_incslope::Int
    inc_slope::Float64
    dd_decslope::Int
    dec_slope::Float64
end</code></pre><p>We can also define default values for the parameters by defining a method with keyword arguments:</p><pre><code class="language-julia hljs">ToyLAIModel(; max_lai=8.0, dd_incslope=500, inc_slope=70, dd_decslope=1000, dec_slope=20) = ToyLAIModel(max_lai, dd_incslope, inc_slope, dd_decslope, dec_slope)</code></pre><p>This way users can create a model with default parameters just by calling <code>ToyLAIModel()</code>, or they can specify only the parameters they want to change, <em>e.g.</em> <code>ToyLAIModel(inc_slope=80.0)</code></p><h4 id="Define-inputs-/-outputs"><a class="docs-heading-anchor" href="#Define-inputs-/-outputs">Define inputs / outputs</a><a id="Define-inputs-/-outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Define-inputs-/-outputs" title="Permalink"></a></h4><p>Then we can define the inputs and outputs of the model, and the default value at initialization:</p><pre><code class="language-julia hljs">PlantSimEngine.inputs_(::ToyLAIModel) = (TT_cu=-Inf,)
PlantSimEngine.outputs_(::ToyLAIModel) = (LAI=-Inf,)</code></pre><div class="admonition is-info" id="Note-317d385a0fda0e96"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-317d385a0fda0e96" title="Permalink"></a></header><div class="admonition-body"><p>Note that we use <code>-Inf</code> for the default value, it is the recommended value for <code>Float64</code> (-999 for <code>Int</code>), as it is a valid value for this type, and is easy to catch in the outputs if not properly set because it propagates nicely. You can also use <code>NaN</code> instead.</p></div></div><h4 id="Define-the-model-function"><a class="docs-heading-anchor" href="#Define-the-model-function">Define the model function</a><a id="Define-the-model-function-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-model-function" title="Permalink"></a></h4><p>Finally, we can define the model function that will be called at each time step:</p><pre><code class="language-julia hljs">function PlantSimEngine.run!(::ToyLAIModel, models, status, meteo, constants=nothing, extra=nothing)
    status.LAI = models.LAI_Dynamic.max_lai * (1 / (1 + exp((models.LAI_Dynamic.dd_incslope - status.TT_cu) / model.LAI_Dynamic.inc_slope)) - 1 / (1 + exp((models.LAI_Dynamic.dd_decslope - status.TT_cu) / models.LAI_Dynamic.dec_slope)))

    if status.LAI &lt; 0
        status.LAI = 0
    end
end</code></pre><div class="admonition is-info" id="Note-f0f44383f0aaae13"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-f0f44383f0aaae13" title="Permalink"></a></header><div class="admonition-body"><p>Note that we don&#39;t return the value of the LAI in the definition of the function. This is because we rather update its value in the status directly. The status is a structure that efficiently stores the state of the model at each time step, and it contains all variables either declared as inputs or outputs of the model. This way, we can access the value of the LAI at any time step by calling <code>status.LAI</code>.</p></div></div><div class="admonition is-info" id="Note-3b97e7906ecaf8fd"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-3b97e7906ecaf8fd" title="Permalink"></a></header><div class="admonition-body"><p>The function is defined for <strong>one time step</strong> only, and is called at each time step automatically by PlantSimEngine. This means that we don&#39;t have to loop over the time steps in the function.</p></div></div><h4 id="defining_the_meteo"><a class="docs-heading-anchor" href="#defining_the_meteo">Running a simulation</a><a id="defining_the_meteo-1"></a><a class="docs-heading-anchor-permalink" href="#defining_the_meteo" title="Permalink"></a></h4><p>Now that we have everything set up, we can run a simulation. The first step here is to define the weather:</p><pre><code class="language-julia hljs"># Import the packages we need:
using PlantMeteo, Dates, DataFrames

# Define the period of the simulation:
period = [Dates.Date(&quot;2021-01-01&quot;), Dates.Date(&quot;2021-12-31&quot;)]

# Get the weather data for CIRAD&#39;s site in Montpellier, France:
meteo = get_weather(43.649777, 3.869889, period, sink = DataFrame)

# Compute the degree-days with a base temperature of 10°C:
meteo.TT = max.(meteo.T .- 10.0, 0.0)

# Aggregate the weather data to daily values:
meteo_day = to_daily(meteo, :TT =&gt; (x -&gt; sum(x) / 24) =&gt; :TT)</code></pre><p>Then we can define our list of models, passing the values for <code>TT_cu</code> in the status at initialization:</p><pre><code class="language-julia hljs">m = ModelList(
    ToyLAIModel(),
    status = (TT_cu = cumsum(meteo_day.TT),),
)

outputs_sim = run!(m)

lines(outputs_sim[:TT_cu], outputs_sim[:LAI], color=:green, axis=(ylabel=&quot;LAI (m² m⁻²)&quot;, xlabel=&quot;Days since sowing&quot;))</code></pre><img src="8995ddcd.png" alt="Example block output"/></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Tuesday 27 May 2025 20:13">Tuesday 27 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

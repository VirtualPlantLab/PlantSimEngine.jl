<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implicit contracts · PlantSimEngine.jl</title><meta name="title" content="Implicit contracts · PlantSimEngine.jl"/><meta property="og:title" content="Implicit contracts · PlantSimEngine.jl"/><meta property="twitter:title" content="Implicit contracts · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/troubleshooting_and_testing/implicit_contracts/"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/troubleshooting_and_testing/implicit_contracts/"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/troubleshooting_and_testing/implicit_contracts/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/why_plantsimengine/">Why PlantSimEngine ?</a></li><li><a class="tocitem" href="../../introduction/why_julia/">Why Julia ?</a></li></ul></li><li><span class="tocitem">Prerequisites</span><ul><li><a class="tocitem" href="../../prerequisites/installing_plantsimengine/">Installing and running PlantSimEngine</a></li><li><a class="tocitem" href="../../prerequisites/key_concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../prerequisites/julia_basics/">Julia language basics</a></li></ul></li><li><span class="tocitem">Step by step - Single-scale simulations</span><ul><li><a class="tocitem" href="../../step_by_step/detailed_first_example/">Detailed first simulation</a></li><li><a class="tocitem" href="../../step_by_step/simple_model_coupling/">Coupling</a></li><li><a class="tocitem" href="../../step_by_step/model_switching/">Model Switching</a></li><li><a class="tocitem" href="../../step_by_step/quick_and_dirty_examples/">Quick examples</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_process/">Implementing a process</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model/">Implementing a model</a></li><li><a class="tocitem" href="../../step_by_step/parallelization/">Parallelization</a></li><li><a class="tocitem" href="../../step_by_step/advanced_coupling/">Advanced coupling and hard dependencies</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model_additional/">Implementing a model : additional notes</a></li></ul></li><li><a class="tocitem" href="../../model_execution/">Execution</a></li><li><span class="tocitem">Working with data</span><ul><li><a class="tocitem" href="../../working_with_data/reducing_dof/">Reducing DoF</a></li><li><a class="tocitem" href="../../working_with_data/fitting/">Fitting</a></li><li><a class="tocitem" href="../../working_with_data/inputs/">Input types</a></li><li><a class="tocitem" href="../../working_with_data/visualising_outputs/">Visualizing outputs and data</a></li><li><a class="tocitem" href="../../working_with_data/floating_point_accumulation_error/">Floating-point considerations</a></li></ul></li><li><span class="tocitem">Moving to multiscale</span><ul><li><a class="tocitem" href="../../multiscale/multiscale_considerations/">Multiscale considerations</a></li><li><a class="tocitem" href="../../multiscale/single_to_multiscale/">Converting a simulation to multi-scale</a></li><li><a class="tocitem" href="../../multiscale/multiscale/">More variable mapping examples</a></li><li><a class="tocitem" href="../../multiscale/multiscale_cyclic/">Handling cyclic dependencies</a></li><li><a class="tocitem" href="../../multiscale/multiscale_coupling/">Multiscale coupling considerations</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">Building a simple plant</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../multiscale/multiscale_example_1/">A rudimentary plant simulation</a></li><li><a class="tocitem" href="../../multiscale/multiscale_example_2/">Expanding the plant simulation</a></li><li><a class="tocitem" href="../../multiscale/multiscale_example_3/">Fixing bugs in the plant simulation</a></li></ul></li><li><a class="tocitem" href="../../multiscale/multiscale_example_4/">Visualizing our toy plant with PlantGeom</a></li></ul></li><li><span class="tocitem">Troubleshooting and testing</span><ul><li><a class="tocitem" href="../plantsimengine_and_julia_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../downstream_tests/">Automated testing</a></li><li><a class="tocitem" href="../tips_and_workarounds/">Tips and Workarounds</a></li><li class="is-active"><a class="tocitem" href>Implicit contracts</a><ul class="internal"><li><a class="tocitem" href="#Weather-data-provides-the-simulation-timestep,-but-models-can-veer-away-from-it"><span>Weather data provides the simulation timestep, but models can veer away from it</span></a></li><li><a class="tocitem" href="#Weather-data-must-be-interpolated-prior-to-simulation"><span>Weather data must be interpolated prior to simulation</span></a></li><li><a class="tocitem" href="#No-cyclic-dependencies-in-the-simplified-dependency-graph"><span>No cyclic dependencies in the simplified dependency graph</span></a></li><li><a class="tocitem" href="#Hard-dependencies-need-to-be-declared-in-the-model-definition"><span>Hard dependencies need to be declared in the model definition</span></a></li><li><a class="tocitem" href="#Parallelisation-opportunities-must-be-part-of-the-model-definition"><span>Parallelisation opportunities must be part of the model definition</span></a></li><li><a class="tocitem" href="#Hard-dependencies-can-only-have-one-parent-in-the-dependency-graph"><span>Hard dependencies can only have one parent in the dependency graph</span></a></li><li><a class="tocitem" href="#A-model-can-only-be-used-once-per-scale"><span>A model can only be used once per scale</span></a></li><li><a class="tocitem" href="#No-two-variables-with-the-same-name-at-the-same-scale"><span>No two variables with the same name at the same scale</span></a></li><li><a class="tocitem" href="#Simulation-order-instability-when-adding-models"><span>Simulation order instability when adding models</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/API_public/">Public API</a></li><li><a class="tocitem" href="../../API/API_examples/">Example models</a></li><li><a class="tocitem" href="../../API/API_private/">Internal API</a></li></ul></li><li><a class="tocitem" href="../../documentation_improvement/">Improving our documentation</a></li><li><a class="tocitem" href="../../developers/">Developer guidelines</a></li><li><a class="tocitem" href="../../planned_features/">Planned features</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Troubleshooting and testing</a></li><li class="is-active"><a href>Implicit contracts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implicit contracts</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs/src/troubleshooting_and_testing/implicit_contracts.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>This page summarizes some of the assumptions, coupling constraints and inner workings of PlantSimEngine which may be particular relevant when implementing new models.</p><p>If you are unsure of an implementation subtlety, check this page out to see whether it answers your question.</p><ul><li class="no-marker"><ul><li><a href="#Weather-data-provides-the-simulation-timestep,-but-models-can-veer-away-from-it">Weather data provides the simulation timestep, but models can veer away from it</a></li><li><a href="#Weather-data-must-be-interpolated-prior-to-simulation">Weather data must be interpolated prior to simulation</a></li><li><a href="#No-cyclic-dependencies-in-the-simplified-dependency-graph">No cyclic dependencies in the simplified dependency graph</a></li><li><a href="#Hard-dependencies-need-to-be-declared-in-the-model-definition">Hard dependencies need to be declared in the model definition</a></li><li><a href="#Parallelisation-opportunities-must-be-part-of-the-model-definition">Parallelisation opportunities must be part of the model definition</a></li><li><a href="#Hard-dependencies-can-only-have-one-parent-in-the-dependency-graph">Hard dependencies can only have one parent in the dependency graph</a></li><li><a href="#A-model-can-only-be-used-once-per-scale">A model can only be used once per scale</a></li><li><a href="#No-two-variables-with-the-same-name-at-the-same-scale">No two variables with the same name at the same scale</a></li><li><a href="#Simulation-order-instability-when-adding-models">Simulation order instability when adding models</a></li></ul></li></ul><h2 id="Weather-data-provides-the-simulation-timestep,-but-models-can-veer-away-from-it"><a class="docs-heading-anchor" href="#Weather-data-provides-the-simulation-timestep,-but-models-can-veer-away-from-it">Weather data provides the simulation timestep, but models can veer away from it</a><a id="Weather-data-provides-the-simulation-timestep,-but-models-can-veer-away-from-it-1"></a><a class="docs-heading-anchor-permalink" href="#Weather-data-provides-the-simulation-timestep,-but-models-can-veer-away-from-it" title="Permalink"></a></h2><p>The weather data timesteps, whether hourly or daily, provide the pace at which most other models run.</p><p>In XPalm, weather data for most models is provided daily, meaning biomass calculations are also provided daily. </p><p>Many models are considered to be steady-state over that timeframe, but not all : the leaf pruning model pertubes the plant in a non-steady state fashion, for example. Models that require computations over several iterations to stabilise (often part of hard dependencies) might also have a timestep unrelated to the weather data.</p><p>!!! Note     Implicitely, this means any vector variables given as input to the simulation must be consistent with the number of weather timesteps. Providing one weather value but a larger vector variable is an exception : the weather data is replicated over each timestep. (This may be subject to change in the future when support for different timesteps in a single simulation is implemented)</p><h2 id="Weather-data-must-be-interpolated-prior-to-simulation"><a class="docs-heading-anchor" href="#Weather-data-must-be-interpolated-prior-to-simulation">Weather data must be interpolated prior to simulation</a><a id="Weather-data-must-be-interpolated-prior-to-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Weather-data-must-be-interpolated-prior-to-simulation" title="Permalink"></a></h2><p>If your weather data isn&#39;t adjusted to conform to a regular timestep, you will need to adjust it to fit that constraint. PlantSimEngine does no interpolation prior to simulation and expects regular weather timesteps.</p><h2 id="No-cyclic-dependencies-in-the-simplified-dependency-graph"><a class="docs-heading-anchor" href="#No-cyclic-dependencies-in-the-simplified-dependency-graph">No cyclic dependencies in the simplified dependency graph</a><a id="No-cyclic-dependencies-in-the-simplified-dependency-graph-1"></a><a class="docs-heading-anchor-permalink" href="#No-cyclic-dependencies-in-the-simplified-dependency-graph" title="Permalink"></a></h2><p>The model dependency graph used for running the simulation is comprised of soft and hard dependency nodes, and the final version only links soft dependency nodes together, and is expected to contain no cycles.</p><p>Any user model coupling which causes a cyclic dependency to occur will require some extra tinkering to run : either design models differently, create a hard dependency with some of the problematic models, or break the cycle by having a variable take the previous timestep&#39;s value as input.</p><p>See <a href="../../prerequisites/key_concepts/#Dependency-graphs">Dependency graphs</a> and the following subsections for more discussion related to dependency graph constraints.</p><p>Note : Only the previous timestep is accessible in PlantSimEngine without any kind of dedicated model. How to create a model to store more past timesteps of a specific variable is described in the <a href="../tips_and_workarounds/#Tips-and-workarounds">Tips and workarounds</a> page: <a href="../tips_and_workarounds/#Making-use-of-past-states-in-multi-scale-simulations">Making use of past states in multi-scale simulations</a></p><h2 id="Hard-dependencies-need-to-be-declared-in-the-model-definition"><a class="docs-heading-anchor" href="#Hard-dependencies-need-to-be-declared-in-the-model-definition">Hard dependencies need to be declared in the model definition</a><a id="Hard-dependencies-need-to-be-declared-in-the-model-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Hard-dependencies-need-to-be-declared-in-the-model-definition" title="Permalink"></a></h2><p>Hard dependencies are handled internally by their owning soft dependency model, ie the hard dep&#39;s run! function is directly called by the soft dependency&#39;s run!.</p><p>The current way in which PlantSimEngine creates its dependency graph requires users to declare what process is required in the hard dependency and which scale it pulls the model and its variables from.</p><h2 id="Parallelisation-opportunities-must-be-part-of-the-model-definition"><a class="docs-heading-anchor" href="#Parallelisation-opportunities-must-be-part-of-the-model-definition">Parallelisation opportunities must be part of the model definition</a><a id="Parallelisation-opportunities-must-be-part-of-the-model-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Parallelisation-opportunities-must-be-part-of-the-model-definition" title="Permalink"></a></h2><p>Traits that indicate that a model is independent or objects need to be part of the model definition. Modelers need to keep this in mind when implementing new models.</p><p>This is currently mostly a concern for single-scale simulations, as multi-scale simulations are not currently parallelised ; a more involved scheduler would need to be implemented when MTGs are modified by models, and to handle more interesting parallelisation opportunities at specific scales. </p><p>There may be new parallelisation features for multi-plant simulations further down the road.</p><h2 id="Hard-dependencies-can-only-have-one-parent-in-the-dependency-graph"><a class="docs-heading-anchor" href="#Hard-dependencies-can-only-have-one-parent-in-the-dependency-graph">Hard dependencies can only have one parent in the dependency graph</a><a id="Hard-dependencies-can-only-have-one-parent-in-the-dependency-graph-1"></a><a class="docs-heading-anchor-permalink" href="#Hard-dependencies-can-only-have-one-parent-in-the-dependency-graph" title="Permalink"></a></h2><p>The final dependency graph is comprised only of soft dependency nodes, and is guaranteed to contain no cycles. Hard dependencies are handled internally by their soft dependency ancestor. To avoid any ambiguity in terms of processing order, only one soft dependency node can &#39;own&#39; a hard dependency And similarly, nested hard dependencies only have a single soft dependency ancestor.</p><p>This is not solely an implementation detail of PlantSimEngine&#39;s internal mechanisms ; if your simulation requires complex coupling, you might need to carefully consider how to manage your hard dependencies, or insert an extra intermediate model to simplify things.</p><h2 id="A-model-can-only-be-used-once-per-scale"><a class="docs-heading-anchor" href="#A-model-can-only-be-used-once-per-scale">A model can only be used once per scale</a><a id="A-model-can-only-be-used-once-per-scale-1"></a><a class="docs-heading-anchor-permalink" href="#A-model-can-only-be-used-once-per-scale" title="Permalink"></a></h2><p>Similarly, to avoid depedency graph ambiguity (and for simulation cohesion), PlantSimEngine currently assumes a model describing a process only occurs once per scale.</p><p>Model renaming and duplicating works around this assumption. It may change once multi-plant/multi-species features are implemented.</p><h2 id="No-two-variables-with-the-same-name-at-the-same-scale"><a class="docs-heading-anchor" href="#No-two-variables-with-the-same-name-at-the-same-scale">No two variables with the same name at the same scale</a><a id="No-two-variables-with-the-same-name-at-the-same-scale-1"></a><a class="docs-heading-anchor-permalink" href="#No-two-variables-with-the-same-name-at-the-same-scale" title="Permalink"></a></h2><p>This rule avoids potential ambiguity which could then cause both problems in terms of model ordering during the simulation, as well as incorrectly coupling models with the wrong variable.</p><p>A workaround for some of the situations where this occurs is described here : <a href="../tips_and_workarounds/#Having-a-variable-simultaneously-as-input-and-output-of-a-model">Having a variable simultaneously as input and output of a model</a></p><h2 id="Simulation-order-instability-when-adding-models"><a class="docs-heading-anchor" href="#Simulation-order-instability-when-adding-models">Simulation order instability when adding models</a><a id="Simulation-order-instability-when-adding-models-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-order-instability-when-adding-models" title="Permalink"></a></h2><p>An important aspect to bear in mind is that PlantSimEngine automatically determines an order in which models are run from the dependency graph it generates by coupling models together. </p><p>This order of simulation depends on the way the models link together. If you replace a model by a new set of models, or pass in new variables that create new links between models, you may change the simulation order.</p><p>When iterating and slowly making a simulation more physiologically realistic and complex, it is therefore fully possible that the order in which two models are run is flipped by a user change. </p><p>This design choice implementation -a concession made for ease of use and flexibility when developing a simulation- means that until your set of models is fully stabilized and you know which variables are <code>PreviousTimestep</code> and what order models run in, as you expand and change the set you might see differences of execution of one timestep for some models. It isn&#39;t a conceptual problem as most models are steady-state, and simulation order is stable for a given set of models, but it does mean PlantSimEngine will be less conveient for some types of simulation.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tips_and_workarounds/">« Tips and Workarounds</a><a class="docs-footer-nextpage" href="../../API/API_public/">Public API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 3 December 2025 14:57">Wednesday 3 December 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

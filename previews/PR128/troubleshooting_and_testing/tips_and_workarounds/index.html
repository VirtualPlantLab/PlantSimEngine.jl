<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tips and Workarounds · PlantSimEngine.jl</title><meta name="title" content="Tips and Workarounds · PlantSimEngine.jl"/><meta property="og:title" content="Tips and Workarounds · PlantSimEngine.jl"/><meta property="twitter:title" content="Tips and Workarounds · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/troubleshooting_and_testing/tips_and_workarounds/"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/troubleshooting_and_testing/tips_and_workarounds/"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/troubleshooting_and_testing/tips_and_workarounds/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/why_plantsimengine/">Why PlantSimEngine ?</a></li><li><a class="tocitem" href="../../introduction/why_julia/">Why Julia ?</a></li></ul></li><li><span class="tocitem">Prerequisites</span><ul><li><a class="tocitem" href="../../prerequisites/key_concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../prerequisites/julia_basics/">Julia language basics</a></li></ul></li><li><span class="tocitem">Step by step - Single-scale simulations</span><ul><li><a class="tocitem" href="../../step_by_step/detailed_first_example/">Detailed first simulation</a></li><li><a class="tocitem" href="../../step_by_step/simple_model_coupling/">Coupling</a></li><li><a class="tocitem" href="../../step_by_step/model_switching/">Model Switching</a></li><li><a class="tocitem" href="../../step_by_step/quick_and_dirty_examples/">Quick examples</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_process/">Implementing a process</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model/">Implementing a model</a></li><li><a class="tocitem" href="../../step_by_step/parallelization/">Parallelization</a></li><li><a class="tocitem" href="../../step_by_step/advanced_coupling/">Advanced coupling and hard dependencies</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model_additional/">Implementing a model : additional notes</a></li></ul></li><li><a class="tocitem" href="../../model_execution/">Execution</a></li><li><span class="tocitem">Working with data</span><ul><li><a class="tocitem" href="../../working_with_data/reducing_dof/">Reducing DoF</a></li><li><a class="tocitem" href="../../working_with_data/fitting/">Fitting</a></li><li><a class="tocitem" href="../../working_with_data/inputs/">Input types</a></li><li><a class="tocitem" href="../../working_with_data/visualising_outputs/">Visualizing outputs</a></li><li><a class="tocitem" href="../../working_with_data/floating_point_accumulation_error/">Floating-point considerations</a></li></ul></li><li><span class="tocitem">Moving to multiscale</span><ul><li><a class="tocitem" href="../../multiscale/multiscale_considerations/">Multiscale considerations</a></li><li><a class="tocitem" href="../../multiscale/single_to_multiscale/">Converting a simulation to multi-scale</a></li><li><a class="tocitem" href="../../multiscale/multiscale/">More variable mapping examples</a></li><li><a class="tocitem" href="../../multiscale/multiscale_cyclic/">Handling cyclic dependencies</a></li><li><a class="tocitem" href="../../multiscale/multiscale_coupling/">Multiscale coupling considerations</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">Building a simple plant</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../multiscale/multiscale_example_1/">A rudimentary plant simulation</a></li><li><a class="tocitem" href="../../multiscale/multiscale_example_2/">Expanding the plant simulation</a></li><li><a class="tocitem" href="../../multiscale/multiscale_example_3/">Fixing bugs in the plant simulation</a></li></ul></li></ul></li><li><span class="tocitem">Troubleshooting and testing</span><ul><li><a class="tocitem" href="../plantsimengine_and_julia_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../downstream_tests/">Automated testing</a></li><li class="is-active"><a class="tocitem" href>Tips and Workarounds</a><ul class="internal"><li><a class="tocitem" href="#PlantSimEngine-is-actively-being-developed"><span>PlantSimEngine is actively being developed</span></a></li><li><a class="tocitem" href="#Making-use-of-past-states-in-multi-scale-simulations"><span>Making use of past states in multi-scale simulations</span></a></li><li><a class="tocitem" href="#Having-a-variable-simultaneously-as-input-and-output-of-a-model"><span>Having a variable simultaneously as input and output of a model</span></a></li><li><a class="tocitem" href="#multiscale_vector"><span>Multiscale : passing in a vector in a mapping status at a specific scale</span></a></li><li><a class="tocitem" href="#Cyclic-dependencies-in-single-scale-simulations"><span>Cyclic dependencies in single-scale simulations</span></a></li></ul></li><li><a class="tocitem" href="../implicit_contracts/">Implicit contracts</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/API_public/">Public API</a></li><li><a class="tocitem" href="../../API/API_private/">Internal API</a></li></ul></li><li><a class="tocitem" href="../../credits/">Credits</a></li><li><a class="tocitem" href="../../documentation_improvement/">Improving our documentation</a></li><li><a class="tocitem" href="../../planned_features/">Planned features</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Troubleshooting and testing</a></li><li class="is-active"><a href>Tips and Workarounds</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tips and Workarounds</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs/src/troubleshooting_and_testing/tips_and_workarounds.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tips-and-workarounds"><a class="docs-heading-anchor" href="#Tips-and-workarounds">Tips and workarounds</a><a id="Tips-and-workarounds-1"></a><a class="docs-heading-anchor-permalink" href="#Tips-and-workarounds" title="Permalink"></a></h1><h2 id="PlantSimEngine-is-actively-being-developed"><a class="docs-heading-anchor" href="#PlantSimEngine-is-actively-being-developed">PlantSimEngine is actively being developed</a><a id="PlantSimEngine-is-actively-being-developed-1"></a><a class="docs-heading-anchor-permalink" href="#PlantSimEngine-is-actively-being-developed" title="Permalink"></a></h2><p>PlantSimEngine, despite the somewhat abstract codebase and generic simulation ambitions, is quite grounded in reality. There IS a desire to accomodate for a wide range of possible simulations, without constraining the user too much, but most features are developed on an as-needed basis, and grow out of necessity, partly from the requirements of an increasingly complex and refined implementation of an oil palm model, <a href="https://github.com/PalmStudio/XPalm.jl">XPalm</a>.</p><p>Since the oil palm model is actively being developed, and some features aren&#39;t ready in PlantSimEngine, or require a lot of rewriting that we&#39;re not certain would be worth it (especially if it ends up constraining the codebase or what the user can do), some workarounds and shortcuts are occasionally used to circumvent a limitation. </p><p>There are also a couple of features that are quick hacks or that are meant for quick and dirty prototyping, not for production. </p><p>We&#39;ll list a few of them here, and will likely add some entry in the future listing some built-in limitations or implicit expectations of the package.</p><ul><li><a href="#Tips-and-workarounds">Tips and workarounds</a></li><li class="no-marker"><ul><li><a href="#PlantSimEngine-is-actively-being-developed">PlantSimEngine is actively being developed</a></li><li><a href="#Making-use-of-past-states-in-multi-scale-simulations">Making use of past states in multi-scale simulations</a></li><li><a href="#Having-a-variable-simultaneously-as-input-and-output-of-a-model">Having a variable simultaneously as input and output of a model</a></li><li><a href="#multiscale_vector">Multiscale : passing in a vector in a mapping status at a specific scale</a></li><li><a href="#Cyclic-dependencies-in-single-scale-simulations">Cyclic dependencies in single-scale simulations</a></li></ul></li></ul><h2 id="Making-use-of-past-states-in-multi-scale-simulations"><a class="docs-heading-anchor" href="#Making-use-of-past-states-in-multi-scale-simulations">Making use of past states in multi-scale simulations</a><a id="Making-use-of-past-states-in-multi-scale-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Making-use-of-past-states-in-multi-scale-simulations" title="Permalink"></a></h2><p>It is possible to make use of the value of a variable in the past simulation timestep via the <code>PreviousTimeStep</code> mechanism in the mapping API (In fact, as mentioned elsewhere, it is the default way to break undesirable cyclic dependencies that can come up when coupling models, see : <a href="../../multiscale/multiscale_cyclic/#Avoiding-cyclic-dependencies">Avoiding cyclic dependencies</a>).</p><p>However, it is not possible to go beyond that through the mapping API. Something like <code>PreviousTimeStep(PreviousTimeStep(PreviousTimeStep(:carbon_biomass)))</code> is not supported. Don&#39;t do that.</p><p>One way to access prior variable states is simply to write an ad hoc model that stores a few values into an array or however many variables you might need, which you can then update every timestep and feed into other models that might need it.</p><h2 id="Having-a-variable-simultaneously-as-input-and-output-of-a-model"><a class="docs-heading-anchor" href="#Having-a-variable-simultaneously-as-input-and-output-of-a-model">Having a variable simultaneously as input and output of a model</a><a id="Having-a-variable-simultaneously-as-input-and-output-of-a-model-1"></a><a class="docs-heading-anchor-permalink" href="#Having-a-variable-simultaneously-as-input-and-output-of-a-model" title="Permalink"></a></h2><p>One current limitation of <code>PlantSimEngine</code> that can be occasionally awkward is that using the same variable name as input and output in a single model is unsupported. </p><p>(On a related note : it is not possible to have two variables with the same name <em>in the same scale</em>. They are considered as the same variable.)</p><p>The reason being that it is usually impossible to automatically determine how the coupling is supposed to work out, when other dependencies latch onto such a model. The user would have to explicitely declare some order of simulation between several models, and some amount of programmer work would also be necessary to implement that extra API feature into <code>PlantSimEngine</code>.</p><p>We haven&#39;t found an approach that was fully satisfactory from both a code simplicity and an API convenience POV. Especially when prototyping and adding in new models, as that might require redeclaring the simulation order for those specific variables.</p><p>There are two workarounds : </p><p>One awkward approach is to rename one of the variables. It is not ideal, of course, as it means you might not be able to use a predefined model &#39;out of the box&#39;, but it does not have any of the tradeoffs and constrained mentioned above.</p><p>In many other situations one can work with what PlantSimEngine already provides.</p><p>For example, one model in <a href="https://github.com/PalmStudio/XPalm.jl/blob/main/src/plant/phytomer/leaves/leaf_pruning.jl">XPalm.jl</a> handles leaf pruning, affecting biomass. A straightforward implementation would be to have a <code>leaf_biomass</code> variable as both input and output. The workaround is to instead output a variable <code>leaf_biomass_pruning_loss</code> and to have that as input in the next timestep to compute the new leaf biomass.</p><p>TODO use toy plant as example</p><h2 id="multiscale_vector"><a class="docs-heading-anchor" href="#multiscale_vector">Multiscale : passing in a vector in a mapping status at a specific scale</a><a id="multiscale_vector-1"></a><a class="docs-heading-anchor-permalink" href="#multiscale_vector" title="Permalink"></a></h2><p>TODO example from single to multiscale</p><p>You may have noticed that sometimes a vector (1-dimensional array) variable is passed into the <code>status</code> component of a <code>ModelList</code> in documentation examples (An example here with cumulative thermal time : <a href="../../step_by_step/model_switching/#Model-switching">Model switching</a>).</p><p>This is practical for simple simulations, or when quickly prototyping, to avoid having to write a model specifically for it. Whatever models make use of that variable are provided with one element corresponding to the current timestep every iteration.</p><p>In multi-scale simulations, this feature is also supported, though not part of the main API. The way outputs and statuses work is a little different, so that little convenience feature is not as straightforward. </p><p>It is more brittle, makes use of not-recommended Julia metaprogramming features (<code>eval()</code>), fiddles with global variables, might not work outside of a REPL environment and is not tested for more complex interactions, so it may interact badly with variables that are mapped to different scales or in bizarre dependency couplings.</p><p>Due to, uh, implementation quirks, the way to use this is as follows : </p><p>Call the function <code>replace_mapping_status_vectors_with_generated_models(mapping_with_vectors_in_status, timestep_model_organ_level, nsteps)</code>on your mapping.</p><p>It will parse your mapping, generate custom models to store and feed the vector values each timestep, and return the new mapping you can then use for your simulation. It also slips in a couple of internal models that provide the timestep index to these models (so note that symbols <code>:current_timestep</code> and <code>:next_timestep</code> will be declared for that mapping). You can decide which scale/organ level you want those models to be in via the <code>timestep_model_organ_level</code>parameter. <code>nsteps</code> is used as a sanity check, and expects you to provide the amount of simulation timesteps.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Only subtypes of AbstractVector present in statuses will be affected. In some cases, meteo values might need a small conversion. For instance : <code>meteo_day = CSV.read(joinpath(pkgdir(PlantSimEngine), &quot;examples/meteo_day.csv&quot;), DataFrame, header=18) status(TT_cu=cumsum(meteo_day.TT),)</code></p><p>cumsum(meteo<em>day.TT) actually returns a CSV.SentinelArray.ChainedVectors{T, Vector{T}}, which is not a subtype of AbstractVector.  Replacing it with Vector(cumsum(meteo</em>day.TT)) will provide an adequate type.</p></div></div><p>This feature is likely to break in simulations that make use of planned future features (such as mixing models with different timesteps), without guarantee of a fix on a short notice. Again, bear in mind it is mostly a convenient shortcut for prototyping, when doing multi-scale simulations.</p><p>TODO state machines ? TODO workaround status initialisation bug ?</p><h2 id="Cyclic-dependencies-in-single-scale-simulations"><a class="docs-heading-anchor" href="#Cyclic-dependencies-in-single-scale-simulations">Cyclic dependencies in single-scale simulations</a><a id="Cyclic-dependencies-in-single-scale-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Cyclic-dependencies-in-single-scale-simulations" title="Permalink"></a></h2><p>Cyclic dependencies can happen in single-scale simulations, but the PreviousTimestep feature currently isn&#39;t available. Hard dependencies are one way to deal with them, creating a multi-scale simulation with a single effective scale is also an option.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../downstream_tests/">« Automated testing</a><a class="docs-footer-nextpage" href="../implicit_contracts/">Implicit contracts »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 6 March 2025 15:26">Thursday 6 March 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

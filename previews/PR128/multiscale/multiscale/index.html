<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>More variable mapping examples · PlantSimEngine.jl</title><meta name="title" content="More variable mapping examples · PlantSimEngine.jl"/><meta property="og:title" content="More variable mapping examples · PlantSimEngine.jl"/><meta property="twitter:title" content="More variable mapping examples · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale/"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale/"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/why_plantsimengine/">Why PlantSimEngine ?</a></li><li><a class="tocitem" href="../../introduction/why_julia/">Why Julia ?</a></li></ul></li><li><span class="tocitem">Prerequisites</span><ul><li><a class="tocitem" href="../../prerequisites/key_concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../prerequisites/julia_basics/">Julia language basics</a></li></ul></li><li><span class="tocitem">Step by step - Single-scale simulations</span><ul><li><a class="tocitem" href="../../step_by_step/detailed_first_example/">Detailed first simulation</a></li><li><a class="tocitem" href="../../step_by_step/simple_model_coupling/">Coupling</a></li><li><a class="tocitem" href="../../step_by_step/model_switching/">Model Switching</a></li><li><a class="tocitem" href="../../step_by_step/quick_and_dirty_examples/">Quick examples</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_process/">Implementing a process</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model/">Implementing a model</a></li><li><a class="tocitem" href="../../step_by_step/parallelization/">Parallelization</a></li><li><a class="tocitem" href="../../step_by_step/advanced_coupling/">Advanced coupling and hard dependencies</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model_additional/">Implementing a model : additional notes</a></li></ul></li><li><a class="tocitem" href="../../model_execution/">Execution</a></li><li><span class="tocitem">Working with data</span><ul><li><a class="tocitem" href="../../working_with_data/reducing_dof/">Reducing DoF</a></li><li><a class="tocitem" href="../../working_with_data/fitting/">Fitting</a></li><li><a class="tocitem" href="../../working_with_data/inputs/">Input types</a></li><li><a class="tocitem" href="../../working_with_data/visualising_outputs/">Visualizing outputs and data</a></li><li><a class="tocitem" href="../../working_with_data/floating_point_accumulation_error/">Floating-point considerations</a></li></ul></li><li><span class="tocitem">Moving to multiscale</span><ul><li><a class="tocitem" href="../multiscale_considerations/">Multiscale considerations</a></li><li><a class="tocitem" href="../single_to_multiscale/">Converting a simulation to multi-scale</a></li><li class="is-active"><a class="tocitem" href>More variable mapping examples</a><ul class="internal"><li><a class="tocitem" href="#Starting-with-a-single-model-mapping"><span>Starting with a single-model mapping</span></a></li><li><a class="tocitem" href="#Multiscale-mapping-between-models-and-scales"><span>Multiscale mapping between models and scales</span></a></li><li><a class="tocitem" href="#A-more-elaborate-multiscale-model-mapping"><span>A more elaborate multiscale model mapping</span></a></li><li><a class="tocitem" href="#Different-possible-variable-mappings"><span>Different possible variable mappings</span></a></li><li><a class="tocitem" href="#Running-a-simulation"><span>Running a simulation</span></a></li></ul></li><li><a class="tocitem" href="../multiscale_cyclic/">Handling cyclic dependencies</a></li><li><a class="tocitem" href="../multiscale_coupling/">Multiscale coupling considerations</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">Building a simple plant</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../multiscale_example_1/">A rudimentary plant simulation</a></li><li><a class="tocitem" href="../multiscale_example_2/">Expanding the plant simulation</a></li><li><a class="tocitem" href="../multiscale_example_3/">Fixing bugs in the plant simulation</a></li></ul></li></ul></li><li><span class="tocitem">Troubleshooting and testing</span><ul><li><a class="tocitem" href="../../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/downstream_tests/">Automated testing</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/tips_and_workarounds/">Tips and Workarounds</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/implicit_contracts/">Implicit contracts</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/API_public/">Public API</a></li><li><a class="tocitem" href="../../API/API_private/">Internal API</a></li></ul></li><li><a class="tocitem" href="../../credits/">Credits</a></li><li><a class="tocitem" href="../../documentation_improvement/">Improving our documentation</a></li><li><a class="tocitem" href="../../planned_features/">Planned features</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Moving to multiscale</a></li><li class="is-active"><a href>More variable mapping examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>More variable mapping examples</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs/src/multiscale/multiscale.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Multi-scale-variable-mapping"><a class="docs-heading-anchor" href="#Multi-scale-variable-mapping">Multi-scale variable mapping</a><a id="Multi-scale-variable-mapping-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-scale-variable-mapping" title="Permalink"></a></h1><p>The previous page showed how to convert a single-scale simulation to multi-scale.</p><p>This page provides another example showcasing the nuances in variable mapping, with a more complex fully multiscale version of a prior simulation. The models will all be taken form the <a href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/tree/main/examples">examples folder</a>.</p><ul><li><a href="#Multi-scale-variable-mapping">Multi-scale variable mapping</a></li><li class="no-marker"><ul><li><a href="#Starting-with-a-single-model-mapping">Starting with a single-model mapping</a></li><li><a href="#Multiscale-mapping-between-models-and-scales">Multiscale mapping between models and scales</a></li><li><a href="#A-more-elaborate-multiscale-model-mapping">A more elaborate multiscale model mapping</a></li><li><a href="#Different-possible-variable-mappings">Different possible variable mappings</a></li><li><a href="#Running-a-simulation">Running a simulation</a></li><li class="no-marker"><ul><li><a href="#Plant-graph">Plant graph</a></li><li><a href="#Output-variables">Output variables</a></li><li><a href="#Meteorological-data">Meteorological data</a></li><li><a href="#Simulation">Simulation</a></li></ul></li></ul></li></ul><h2 id="Starting-with-a-single-model-mapping"><a class="docs-heading-anchor" href="#Starting-with-a-single-model-mapping">Starting with a single-model mapping</a><a id="Starting-with-a-single-model-mapping-1"></a><a class="docs-heading-anchor-permalink" href="#Starting-with-a-single-model-mapping" title="Permalink"></a></h2><p>Let&#39;s import the <code>PlantSimEngine</code> package and all the example models we will use in this tutorial:</p><pre><code class="language-julia hljs">using PlantSimEngine
using PlantSimEngine.Examples # Import some example models</code></pre><p>Let&#39;s create a simple mapping with only one initial model, the carbon assimilation process <code>ToyAssimModel</code>, which will operate on leaves. It resembles the <code>ToyAssimGrowth</code> model used in the single-scale simulation <a href="../../step_by_step/model_switching/#Model-switching">Model switching</a> subsection.</p><p>Our mapping between scale and model is therefore:</p><pre><code class="language-julia hljs">mapping = Dict(&quot;Leaf&quot; =&gt; ToyAssimModel())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, PlantSimEngine.Examples.ToyAssimModel{Float64}} with 1 entry:
  &quot;Leaf&quot; =&gt; ToyAssimModel{Float64}(0.2)</code></pre><p>Just like in single-scale simulations, we can call <code>to_initialize</code> to check whether variables need to be initialised. It will this time index by scale:</p><pre><code class="language-julia hljs">to_initialize(mapping)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Vector{Symbol}} with 1 entry:
  &quot;Leaf&quot; =&gt; [:aPPFD, :soil_water_content]</code></pre><p>In this example, the <code>ToyAssimModel</code> needs <code>:aPPFD</code> and <code>:soil_water_content</code> as inputs, which aren&#39;t initialised in our mapping.</p><p>The initialization values for the variables can be passed along via a <code>Status</code> object:</p><pre><code class="language-julia hljs">mapping = Dict(
    &quot;Leaf&quot; =&gt; (
        ToyAssimModel(),
        Status(aPPFD=1300.0, soil_water_content=0.5),
    ),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Tuple{PlantSimEngine.Examples.ToyAssimModel{Float64}, Status{(:aPPFD, :soil_water_content), Tuple{Base.RefValue{Float64}, Base.RefValue{Float64}}}}} with 1 entry:
  &quot;Leaf&quot; =&gt; (ToyAssimModel{Float64}(0.2), Status(aPPFD = 1300.0, soil_water_con…</code></pre><p>If we call <code>to_initialize</code> on this new mapping, it returns an empty dictionary, meaning the mapping is valid, and we can start the simulation:</p><pre><code class="language-julia hljs">to_initialize(mapping)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Vector{Symbol}}()</code></pre><h2 id="Multiscale-mapping-between-models-and-scales"><a class="docs-heading-anchor" href="#Multiscale-mapping-between-models-and-scales">Multiscale mapping between models and scales</a><a id="Multiscale-mapping-between-models-and-scales-1"></a><a class="docs-heading-anchor-permalink" href="#Multiscale-mapping-between-models-and-scales" title="Permalink"></a></h2><p>The <code>soil_water_content</code> variable was provided via the mapping. No model affects it, so it is constant in the above example. We could instead provide a model that computes it based on weather data, and/or a more realistic physical process. </p><p>It also makes sense to have that model operate at a different scale than the &quot;Leaf&quot; scale. There is a dummy soil model called <code>ToySoilModel</code> in the examples folder. Let&#39;s put it at a new &quot;Soil&quot; scale level.</p><p><code>ToyAssimModel</code> is now makes use of the <code>soil_water_content</code> variable from the <code>&quot;Soil&quot;</code> scale, instead of at its own scale via the <code>Status</code> initialization. We therefore need to map <code>soil_water_content</code> from the &quot;Soil&quot; to the &quot;Leaf&quot; scale by wrapping <code>ToyAssimModel</code> in a <code>MultiScaleModel</code>:</p><pre><code class="language-julia hljs">mapping = Dict(
    &quot;Soil&quot; =&gt; ToySoilWaterModel(),
    &quot;Leaf&quot; =&gt; (
        MultiScaleModel(
            model=ToyAssimModel(),
            mapped_variables=[:soil_water_content =&gt; &quot;Soil&quot; =&gt; :soil_water_content,],
        ),
        Status(aPPFD=1300.0),
    ),
);</code></pre><p>In this example, we map the <code>soil_water_content</code> variable at scale &quot;Leaf&quot; to the <code>soil_water_content</code> variable at the <code>&quot;Soil&quot;</code> scale. If the name of the variable is the same between both scales, we can omit the variable name at the origin scale, <em>e.g.</em> <code>[:soil_water_content =&gt; &quot;Soil&quot;]</code>.</p><p>The variable <code>aPPFD</code> is still provided in the <code>Status</code> type as a constant value.</p><p>We can check again if the mapping is valid by calling <code>to_initialize</code>:</p><pre><code class="language-julia hljs">to_initialize(mapping)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Vector{Symbol}}()</code></pre><p>Once again, <code>to_initialize</code> returns an empty dictionary, meaning the mapping is valid.</p><h2 id="A-more-elaborate-multiscale-model-mapping"><a class="docs-heading-anchor" href="#A-more-elaborate-multiscale-model-mapping">A more elaborate multiscale model mapping</a><a id="A-more-elaborate-multiscale-model-mapping-1"></a><a class="docs-heading-anchor-permalink" href="#A-more-elaborate-multiscale-model-mapping" title="Permalink"></a></h2><p>Let&#39;s now expand this mapping, to showcase other ways in which variables can be mapped from one scale to another. We&#39;ll keep the first two models, and add several more to simulate a couple of other processes within our plant.</p><pre><code class="language-julia hljs">mapping = Dict(
    &quot;Scene&quot; =&gt; ToyDegreeDaysCumulModel(),
    &quot;Plant&quot; =&gt; (
        MultiScaleModel(
            model=ToyLAIModel(),
            mapped_variables=[
                :TT_cu =&gt; &quot;Scene&quot;,
            ],
        ),
        Beer(0.6),
        MultiScaleModel(
            model=ToyCAllocationModel(),
            mapped_variables=[
                :carbon_assimilation =&gt; [&quot;Leaf&quot;],
                :carbon_demand =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;],
                :carbon_allocation =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;]
            ],
        ),
        MultiScaleModel(
            model=ToyPlantRmModel(),
            mapped_variables=[:Rm_organs =&gt; [&quot;Leaf&quot; =&gt; :Rm, &quot;Internode&quot; =&gt; :Rm],],
        ),
    ),
    &quot;Internode&quot; =&gt; (
        MultiScaleModel(
            model=ToyCDemandModel(optimal_biomass=10.0, development_duration=200.0),
            mapped_variables=[:TT =&gt; &quot;Scene&quot;,],
        ),
        ToyMaintenanceRespirationModel(1.5, 0.06, 25.0, 0.6, 0.004),
        Status(carbon_biomass=1.0),
    ),
    &quot;Leaf&quot; =&gt; (
        MultiScaleModel(
            model=ToyAssimModel(),
            mapped_variables=[:soil_water_content =&gt; &quot;Soil&quot;, :aPPFD =&gt; &quot;Plant&quot;],
        ),
        MultiScaleModel(
            model=ToyCDemandModel(optimal_biomass=10.0, development_duration=200.0),
            mapped_variables=[:TT =&gt; &quot;Scene&quot;,],
        ),
        ToyMaintenanceRespirationModel(2.1, 0.06, 25.0, 1.0, 0.025),
        Status(carbon_biomass=0.5),
    ),
    &quot;Soil&quot; =&gt; (
        ToySoilWaterModel(),
    ),
);</code></pre><p>This mapping might seem a little more daunting than previous examples, but several models should be recognizable in passing. In fact, you can consider this mapping to be an enhanced and more complex multi-scale version of a previous single-scale example, the coupling between photosynthesis model, a LAI model and a carbon biomass increment model, used in the <a href="../../step_by_step/model_switching/#Model-switching">Model switching</a> subsection.</p><pre><code class="language-julia hljs">models2 = ModelList(
    ToyLAIModel(),
    Beer(0.5),
    ToyAssimGrowthModel(),
    status=(TT_cu=cumsum(meteo_day.TT),),
)</code></pre><p>The multi-scale models simulate carbon capture via photosynthesis and carbon allocation for the plant organs&#39; maintenance respiration and development.</p><p>The LAI and photosynthesis models are the same as in the ModelList example. The <code>ToyDegreeDaysModel</code> provides the Cumulative Thermal Time to the plant. </p><p>The newly introduced models have the following dynamic : </p><p>Carbon allocation is determined (<code>ToyCAllocationModel</code>) for the different organs of the plant (<code>&quot;Leaf&quot;</code> and <code>&quot;Internode&quot;</code>) from the assimilation at the <code>&quot;Leaf&quot;</code> scale (<em>i.e.</em> the offer) and their carbon demand (<code>ToyCDemandModel</code>). The <code>&quot;Soil&quot;</code> scale is used to compute the soil water content (<code>ToySoilWaterModel</code>), which is needed to calculate the assimilation at the <code>&quot;Leaf&quot;</code> scale (<code>ToyAssimModel</code>). Also note that maintenance respiration at computed at the <code>&quot;Leaf&quot;</code> and <code>&quot;Internode&quot;</code> scales (<code>ToyMaintenanceRespirationModel</code>), and aggregated to compute the total maintenance respiration at the <code>&quot;Plant&quot;</code> scale (<code>ToyPlantRmModel</code>). </p><h2 id="Different-possible-variable-mappings"><a class="docs-heading-anchor" href="#Different-possible-variable-mappings">Different possible variable mappings</a><a id="Different-possible-variable-mappings-1"></a><a class="docs-heading-anchor-permalink" href="#Different-possible-variable-mappings" title="Permalink"></a></h2><p>The above mapping showcases the different ways to define how the variables are mapped in a <code>MultiScaleModel</code> :</p><pre><code class="language-julia hljs"> mapped_variables=[:TT_cu =&gt; &quot;Scene&quot;,],</code></pre><ul><li>At the &quot;Plant&quot; scale, the TT<em>cu variable is mapped as a scalar from the &quot;Scene&quot; scale. There is only a single &quot;Scene&quot; node in the MTG, and only a single &quot;TT</em>cu&quot; value per timestep for the simulation.</li></ul><pre><code class="language-julia hljs">:carbon_allocation =&gt; [&quot;Leaf&quot;]</code></pre><ul><li>On the other hand, we have <code>:carbon_allocation =&gt; [&quot;Leaf&quot;]</code> at the plant scale for <code>ToyCAllocationModel</code>. The <code>carbon_assimilation</code> variable is mapped as a vector: there are multiple &quot;Leaf&quot; nodes, but only one &quot;Plant&quot; node, which aggregrates the value over every single leaf. This gives us a &#39;many-to-one&#39; vector mapping, and in the <code>run!</code> functions for models at that scale <code>carbon_allocation</code> will be available in the <code>status</code> as a vector.</li></ul><pre><code class="language-julia hljs">:carbon_allocation =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;]</code></pre><ul><li>A third type of the mapping would be <code>:carbon_allocation =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;]</code>, which provides values for a variable from several other scales simultaneously. In this case, the values are also available as a vector in the <code>carbon_assimilation</code> variable of the <code>status</code> inside the model, sorted in the same order as nodes are traversed in the graph.</li></ul><pre><code class="language-julia hljs">:Rm_organs =&gt; [&quot;Leaf&quot; =&gt; :Rm, &quot;Internode&quot; =&gt; :Rm]</code></pre><ul><li>Finally, to map to a specific variable name at the target scale, <em>e.g.</em> <code>:Rm_organs =&gt; [&quot;Leaf&quot; =&gt; :Rm, &quot;Internode&quot; =&gt; :Rm]</code>. This syntax is useful when the variable name is different between scales, and we want to map to a specific variable name at the target scale. In this example, the variable <code>Rm_organs</code> at plant scale takes its values (is mapped) from the variable <code>Rm</code> at the <code>&quot;Leaf&quot;</code> and <code>&quot;Internode&quot;</code> scales.</li></ul><h2 id="Running-a-simulation"><a class="docs-heading-anchor" href="#Running-a-simulation">Running a simulation</a><a id="Running-a-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-simulation" title="Permalink"></a></h2><p>Now that we have a valid mapping, we can run a simulation. Running a multiscale simulation requires a plant graph and the definition of the output variables we want dynamically for each scale.</p><h3 id="Plant-graph"><a class="docs-heading-anchor" href="#Plant-graph">Plant graph</a><a id="Plant-graph-1"></a><a class="docs-heading-anchor-permalink" href="#Plant-graph" title="Permalink"></a></h3><p>We can import an example multi-scale tree graph like so:</p><pre><code class="language-julia hljs">mtg = import_mtg_example()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Scene
├─ / 2: Soil
└─ + 3: Plant
   └─ / 4: Internode
      ├─ + 5: Leaf
      └─ &lt; 6: Internode
         └─ + 7: Leaf
</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>You can use <code>import_mtg_example</code> only if you previously imported the <code>Examples</code> sub-module of PlantSimEngine, <em>i.e.</em> <code>using PlantSimEngine.Examples</code>.</p></div></div><p>This graph has a root node that defines a scene, then a soil, and a plant with two internodes and two leaves.</p><h3 id="Output-variables"><a class="docs-heading-anchor" href="#Output-variables">Output variables</a><a id="Output-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Output-variables" title="Permalink"></a></h3><p>For long simulations on plants with many organs, the output data can be very significant. It&#39;s possible to restrict the output variables that are tracked for the whole simulation to a subset of all the variables:</p><pre><code class="language-julia hljs">outs = Dict(
    &quot;Scene&quot; =&gt; (:TT, :TT_cu,),
    &quot;Plant&quot; =&gt; (:aPPFD, :LAI),
    &quot;Leaf&quot; =&gt; (:carbon_assimilation, :carbon_demand, :carbon_allocation, :TT),
    &quot;Internode&quot; =&gt; (:carbon_allocation,),
    &quot;Soil&quot; =&gt; (:soil_water_content,),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Tuple{Symbol, Vararg{Symbol}}} with 5 entries:
  &quot;Soil&quot;      =&gt; (:soil_water_content,)
  &quot;Internode&quot; =&gt; (:carbon_allocation,)
  &quot;Scene&quot;     =&gt; (:TT, :TT_cu)
  &quot;Plant&quot;     =&gt; (:aPPFD, :LAI)
  &quot;Leaf&quot;      =&gt; (:carbon_assimilation, :carbon_demand, :carbon_allocation, :TT)</code></pre><p>This dictionary can be passed to the simulation via the optional <code>tracked_outputs</code> keyword argument to the <code>run!</code> function (see the next part). If no dictionary is provided, every variable will be tracked.</p><p>These variables will be available in the output returned by <code>run!</code>, with a value for each time step. The corresponding timestep and node in the MTG are also returned. </p><h3 id="Meteorological-data"><a class="docs-heading-anchor" href="#Meteorological-data">Meteorological data</a><a id="Meteorological-data-1"></a><a class="docs-heading-anchor-permalink" href="#Meteorological-data" title="Permalink"></a></h3><p>As for mono-scale models, we need to provide meteorological data to run a simulation. We can use the <code>PlantMeteo</code> package to generate some dummy data for two time steps:</p><pre><code class="language-julia hljs">meteo = Weather(
    [
    Atmosphere(T=20.0, Wind=1.0, Rh=0.65, Ri_PAR_f = 200.0),
    Atmosphere(T=25.0, Wind=0.5, Rh=0.8, Ri_PAR_f = 180.0)
]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TimeStepTable{Atmosphere{(:date, :duration,...}(2 x 22):
<span class="sgr31">╭─────┬─────────────────────────┬──────────────┬─────────┬─────────┬─────────┬──</span>
<span class="sgr31">│</span><span class="sgr1"> Row </span><span class="sgr31">│</span><span class="sgr1">                    date </span><span class="sgr31">│</span><span class="sgr1">     duration </span><span class="sgr31">│</span><span class="sgr1">       T </span><span class="sgr31">│</span><span class="sgr1">    Wind </span><span class="sgr31">│</span><span class="sgr1">       P </span><span class="sgr31">│</span> ⋯
<span class="sgr31">│</span>     <span class="sgr31">│</span><span class="sgr90">          Dates.DateTime </span><span class="sgr31">│</span><span class="sgr90"> Dates.Second </span><span class="sgr31">│</span><span class="sgr90"> Float64 </span><span class="sgr31">│</span><span class="sgr90"> Float64 </span><span class="sgr31">│</span><span class="sgr90"> Float64 </span><span class="sgr31">│</span> ⋯
<span class="sgr31">├─────┼─────────────────────────┼──────────────┼─────────┼─────────┼─────────┼──</span>
<span class="sgr31">│</span>   1 <span class="sgr31">│</span> 2025-03-11T14:09:44.084 <span class="sgr31">│</span>     1 second <span class="sgr31">│</span>    20.0 <span class="sgr31">│</span>     1.0 <span class="sgr31">│</span> 101.325 <span class="sgr31">│</span> ⋯
<span class="sgr31">│</span>   2 <span class="sgr31">│</span> 2025-03-11T14:09:44.084 <span class="sgr31">│</span>     1 second <span class="sgr31">│</span>    25.0 <span class="sgr31">│</span>     0.5 <span class="sgr31">│</span> 101.325 <span class="sgr31">│</span> ⋯
<span class="sgr31">╰─────┴─────────────────────────┴──────────────┴─────────┴─────────┴─────────┴──</span>
<span class="sgr36">                                                              17 columns omitted</span>
</code></pre><h3 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h3><p>Let&#39;s make a simulation using the graph and outputs we just defined:</p><pre><code class="language-julia hljs">outputs_sim = run!(mtg, mapping, meteo, tracked_outputs = outs);</code></pre><p>And that&#39;s it! We can now access the outputs for each scale as a dictionary of vectors of values per variable and scale.</p><p>Or as a <code>DataFrame</code> using the <code>DataFrames</code> package:</p><pre><code class="language-julia hljs">using DataFrames
convert_outputs(outputs_sim, DataFrame)</code></pre><div><div style = "float: left;"><span>14×11 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">timestep</th><th style = "text-align: left;">organ</th><th style = "text-align: left;">node</th><th style = "text-align: left;">carbon_allocation</th><th style = "text-align: left;">TT_cu</th><th style = "text-align: left;">carbon_assimilation</th><th style = "text-align: left;">TT</th><th style = "text-align: left;">aPPFD</th><th style = "text-align: left;">LAI</th><th style = "text-align: left;">soil_water_content</th><th style = "text-align: left;">carbon_demand</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Soil</td><td style = "text-align: right;">2</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Soil</td><td style = "text-align: right;">2</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">4</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">6</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">4</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">6</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Scene</td><td style = "text-align: right;">1</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Scene</td><td style = "text-align: right;">1</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">25.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">15.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Plant</td><td style = "text-align: right;">3</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">3.32692</td><td style = "text-align: left;">0.00607765</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Plant</td><td style = "text-align: right;">3</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">3.43038</td><td style = "text-align: left;">0.00696482</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">5</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.332692</td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">7</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.332692</td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">5</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.343038</td><td style = "text-align: left;">15.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.75</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">7</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.343038</td><td style = "text-align: left;">15.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.75</td></tr></tbody></table></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../single_to_multiscale/">« Converting a simulation to multi-scale</a><a class="docs-footer-nextpage" href="../multiscale_cyclic/">Handling cyclic dependencies »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Tuesday 11 March 2025 14:10">Tuesday 11 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Detailed example · PlantSimEngine.jl</title><meta name="title" content="Detailed example · PlantSimEngine.jl"/><meta property="og:title" content="Detailed example · PlantSimEngine.jl"/><meta property="twitter:title" content="Detailed example · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale/"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale/"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/why_plantsimengine/">Why PlantSimEngine ?</a></li><li><a class="tocitem" href="../../introduction/why_julia/">Why Julia ?</a></li></ul></li><li><span class="tocitem">Prerequisites</span><ul><li><a class="tocitem" href="../../prerequisites/key_concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../prerequisites/julia_basics/">Julia language basics</a></li><li><a class="tocitem" href="../../prerequisites/design/">Design</a></li></ul></li><li><span class="tocitem">Step by step - Single Scale simulations</span><ul><li><a class="tocitem" href="../../step_by_step/simple_model_coupling/">Coupling</a></li><li><a class="tocitem" href="../../step_by_step/model_switching/">Model Switching</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_process/">Processes</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model/">Implementing a model</a></li><li><a class="tocitem" href="../../step_by_step/parallelization/">Parallelization</a></li><li><a class="tocitem" href="../../step_by_step/advanced_coupling/">Advanced coupling and hard dependencies</a></li></ul></li><li><a class="tocitem" href="../../model_execution/">Execution</a></li><li><span class="tocitem">Working with data</span><ul><li><a class="tocitem" href="../../working_with_data/reducing_dof/">Reducing DoF</a></li><li><a class="tocitem" href="../../working_with_data/fitting/">Fitting</a></li><li><a class="tocitem" href="../../working_with_data/inputs/">Input types</a></li><li><a class="tocitem" href="../../working_with_data/visualising_outputs/">Visualizing outputs</a></li></ul></li><li><span class="tocitem">Moving to multiscale</span><ul><li class="is-active"><a class="tocitem" href>Detailed example</a><ul class="internal"><li><a class="tocitem" href="#Moving-to-multi-scale"><span>Moving to multi-scale</span></a></li><li><a class="tocitem" href="#Simple-mapping-between-models-and-scales"><span>Simple mapping between models and scales</span></a></li><li><a class="tocitem" href="#Multiscale-mapping-between-models-and-scales"><span>Multiscale mapping between models and scales</span></a></li><li><a class="tocitem" href="#More-on-MultiScaleModel"><span>More on MultiScaleModel</span></a></li><li><a class="tocitem" href="#Running-a-simulation"><span>Running a simulation</span></a></li></ul></li><li><a class="tocitem" href="../multiscale_cyclic/">Handling cyclic dependencies</a></li><li><a class="tocitem" href="../multiscale_coupling/">Multiscale coupling considerations</a></li><li><input class="collapse-toggle" id="menuitem-7-4" type="checkbox"/><label class="tocitem" for="menuitem-7-4"><span class="docs-label">Building a simple plant</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../multiscale_example_1/">A rudimentary plant simulation</a></li><li><a class="tocitem" href="../multiscale_example_2/">Expanding the plant simulation</a></li><li><a class="tocitem" href="../multiscale_example_3/">Fixing bugs in the plant simulation</a></li></ul></li></ul></li><li><span class="tocitem">Troubleshooting and testing</span><ul><li><a class="tocitem" href="../../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/downstream_tests/">Automated testing</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/tips_and_workarounds/">Tips and Workarounds</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/API_public/">Public API</a></li><li><a class="tocitem" href="../../API/API_private/">Internal API</a></li></ul></li><li><a class="tocitem" href="../../credits/">Credits</a></li><li><a class="tocitem" href="../../planned_features/">Planned features</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Moving to multiscale</a></li><li class="is-active"><a href>Detailed example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Detailed example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs/src/multiscale/multiscale.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Multi-scale-modeling"><a class="docs-heading-anchor" href="#Multi-scale-modeling">Multi-scale modeling</a><a id="Multi-scale-modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-scale-modeling" title="Permalink"></a></h1><h2 id="Moving-to-multi-scale"><a class="docs-heading-anchor" href="#Moving-to-multi-scale">Moving to multi-scale</a><a id="Moving-to-multi-scale-1"></a><a class="docs-heading-anchor-permalink" href="#Moving-to-multi-scale" title="Permalink"></a></h2><p>PlantSimEngine provides a framework for multi-scale modeling to seamlessly integrate models at different scales, keeping all nice functionalities provided at one scale. A nice feature is that many models do not need to be aware of the scale at which they are running, nor about the scales at which their inputs are computed, or outputs will be given, which means those models can be reused at different scales or in single-scale simulations.</p><p>PlantSimEngine automatically computes the dependency graph between mono and multi-scale models, considering every combination of models at any scale, to determine the order of model execution. This means that the user does not need to worry about the order of model execution and can focus on the model definition and the mapping between models and scales.</p><p>Using PlantSimEngine for multi-scale modeling is relatively easy and mostly follows the same rules as mono-scale models. Let&#39;s dive into the details with a short tutorial.</p><h2 id="Simple-mapping-between-models-and-scales"><a class="docs-heading-anchor" href="#Simple-mapping-between-models-and-scales">Simple mapping between models and scales</a><a id="Simple-mapping-between-models-and-scales-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-mapping-between-models-and-scales" title="Permalink"></a></h2><p>To get started, we have to define a mapping between models and scales.</p><p>Let&#39;s import the <code>PlantSimEngine</code> package and example models we will use in this tutorial:</p><pre><code class="language-julia hljs">using PlantSimEngine
using PlantSimEngine.Examples # Import some example models</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The <code>Examples</code> submodule exports a few simple models we will use in this tutorial. The models are also found in the <code>examples</code> folder of the package.</p></div></div><p>We now have access to models for the simulation of different processes. We can associate each model with a scale by defining a mapping between models and scales. The mapping is a dictionary with the name of the scale as the key and the model as the value. For example, we can define a mapping to simulate the assimilation process at the leaf scale with <code>ToyAssimModel</code> as follows:</p><pre><code class="language-julia hljs">mapping = Dict(&quot;Leaf&quot; =&gt; ToyAssimModel())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, PlantSimEngine.Examples.ToyAssimModel{Float64}} with 1 entry:
  &quot;Leaf&quot; =&gt; ToyAssimModel{Float64}(0.2)</code></pre><p>In this example, the dictionary&#39;s key is the name of the scale (<code>&quot;Leaf&quot;</code>), and the value is the model. The model is an example model provided by <code>PlantSimEngine</code>, so we must prefix it with the module name.</p><p>We can check if the mapping is valid by calling <code>to_initialize</code>:</p><pre><code class="language-julia hljs">to_initialize(mapping)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Vector{Symbol}} with 1 entry:
  &quot;Leaf&quot; =&gt; [:aPPFD, :soil_water_content]</code></pre><p>The <code>to_initialize</code> function checks if models from any scale need further initialization before simulation. This is the case when some input variables of the model are not computed by another model. In this example, the <code>ToyAssimModel</code> needs <code>:aPPFD</code> and <code>:soil_water_content</code> as inputs. To run a simulation, we must provide a value for the variables or a model that simulates them.</p><p>The initialization values for the variables can be provided using the <code>Status</code> type along with the model, <em>e.g.</em>:</p><pre><code class="language-julia hljs">mapping = Dict(
    &quot;Leaf&quot; =&gt; (
        ToyAssimModel(),
        Status(aPPFD=1300.0, soil_water_content=0.5),
    ),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Tuple{PlantSimEngine.Examples.ToyAssimModel{Float64}, Status{(:aPPFD, :soil_water_content), Tuple{Base.RefValue{Float64}, Base.RefValue{Float64}}}}} with 1 entry:
  &quot;Leaf&quot; =&gt; (ToyAssimModel{Float64}(0.2), Status(aPPFD = 1300.0, soil_water_con…</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The model and the <code>Status</code> are provided as a <code>Tuple</code> to the <code>&quot;Leaf&quot;</code> scale.</p></div></div><p>If we re-execute <code>to_initialize</code>, we get an empty dictionary, meaning the mapping is valid, and we can start the simulation:</p><pre><code class="language-julia hljs">to_initialize(mapping)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Vector{Symbol}}()</code></pre><h2 id="Multiscale-mapping-between-models-and-scales"><a class="docs-heading-anchor" href="#Multiscale-mapping-between-models-and-scales">Multiscale mapping between models and scales</a><a id="Multiscale-mapping-between-models-and-scales-1"></a><a class="docs-heading-anchor-permalink" href="#Multiscale-mapping-between-models-and-scales" title="Permalink"></a></h2><p>In our previous example, we provided the value for the <code>soil_water_content</code> variable. However, we could also provide a model that simulates it at the soil scale. The only difference now is that we have to tell PlantSimEngine that our  <code>ToyAssimModel</code> is now multiscale and takes the <code>soil_water_content</code> variable from the <code>&quot;Soil&quot;</code> scale. We can do that by wrapping the <code>ToyAssimModel</code> in a <code>MultiScaleModel</code>:</p><pre><code class="language-julia hljs">mapping = Dict(
    &quot;Soil&quot; =&gt; ToySoilWaterModel(),
    &quot;Leaf&quot; =&gt; (
        MultiScaleModel(
            model=ToyAssimModel(),
            mapping=[:soil_water_content =&gt; &quot;Soil&quot; =&gt; :soil_water_content,],
        ),
        Status(aPPFD=1300.0),
    ),
);</code></pre><p>The <code>MultiScaleModel</code> takes two arguments: the model and the mapping between the model and the scales. The mapping is a vector of pairs of pairs mapping the variable&#39;s name with the name of the scale its value comes from, and the name of the variable at that scale. In this example, we map the <code>soil_water_content</code> variable at scale &quot;Leaf&quot; to the <code>soil_water_content</code> variable at the <code>&quot;Soil&quot;</code> scale. If the name of the variable is the same between both scales, we can omit the variable name at the origin scale, <em>e.g.</em> <code>[:soil_water_content =&gt; &quot;Soil&quot;]</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The variable <code>aPPFD</code> is still provided in the <code>Status</code> type as a constant value.</p></div></div><p>We can check again if the mapping is valid by calling <code>to_initialize</code>:</p><pre><code class="language-julia hljs">to_initialize(mapping)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Vector{Symbol}}()</code></pre><p><code>to_initialize</code> returns an empty dictionary, meaning the mapping is valid.</p><h2 id="More-on-MultiScaleModel"><a class="docs-heading-anchor" href="#More-on-MultiScaleModel">More on MultiScaleModel</a><a id="More-on-MultiScaleModel-1"></a><a class="docs-heading-anchor-permalink" href="#More-on-MultiScaleModel" title="Permalink"></a></h2><p><code>MultiScaleModel</code> is a wrapper around a model that allows it to take inputs or give outputs from other scales. It takes two arguments: the model and the mapping between the model and the scales. The mapping is a vector of pairs of pairs mapping the variable&#39;s name with the name of the scale its value comes from, and its name at that scale.</p><p>The variable can map a single value if there is only one node to map to or a vector of values if there are several. It can also map to several types of nodes at the same time.</p><p>Let&#39;s take a look at a more complex example of a mapping:</p><pre><code class="language-julia hljs">mapping = Dict(
    &quot;Scene&quot; =&gt; ToyDegreeDaysCumulModel(),
    &quot;Plant&quot; =&gt; (
        MultiScaleModel(
            model=ToyLAIModel(),
            mapping=[
                :TT_cu =&gt; &quot;Scene&quot;,
            ],
        ),
        Beer(0.6),
        MultiScaleModel(
            model=ToyCAllocationModel(),
            mapping=[
                :carbon_assimilation =&gt; [&quot;Leaf&quot;],
                :carbon_demand =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;],
                :carbon_allocation =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;]
            ],
        ),
        MultiScaleModel(
            model=ToyPlantRmModel(),
            mapping=[:Rm_organs =&gt; [&quot;Leaf&quot; =&gt; :Rm, &quot;Internode&quot; =&gt; :Rm],],
        ),
    ),
    &quot;Internode&quot; =&gt; (
        MultiScaleModel(
            model=ToyCDemandModel(optimal_biomass=10.0, development_duration=200.0),
            mapping=[:TT =&gt; &quot;Scene&quot;,],
        ),
        ToyMaintenanceRespirationModel(1.5, 0.06, 25.0, 0.6, 0.004),
        Status(carbon_biomass=1.0),
    ),
    &quot;Leaf&quot; =&gt; (
        MultiScaleModel(
            model=ToyAssimModel(),
            mapping=[:soil_water_content =&gt; &quot;Soil&quot;, :aPPFD =&gt; &quot;Plant&quot;],
        ),
        MultiScaleModel(
            model=ToyCDemandModel(optimal_biomass=10.0, development_duration=200.0),
            mapping=[:TT =&gt; &quot;Scene&quot;,],
        ),
        ToyMaintenanceRespirationModel(2.1, 0.06, 25.0, 1.0, 0.025),
        Status(carbon_biomass=0.5),
    ),
    &quot;Soil&quot; =&gt; (
        ToySoilWaterModel(),
    ),
);</code></pre><p>In this example, we expect to make a simulation at five different scales: <code>&quot;Scene&quot;</code>, <code>&quot;Plant&quot;</code>, <code>&quot;Internode&quot;</code>, <code>&quot;Leaf&quot;</code>, and <code>&quot;Soil&quot;</code>. The <code>&quot;Scene&quot;</code> scale represents the whole scene, where one or several plants can live. The <code>&quot;Plant&quot;</code> scale is, well, the whole plant scale, <code>&quot;Internode&quot;</code> and <code>&quot;Leaf&quot;</code> are organ scales, and <code>&quot;Soil&quot;</code> is the soil scale. This mapping is used to compute the carbon allocation (<code>ToyCAllocationModel</code>) to the different organs of the plant (<code>&quot;Leaf&quot;</code> and <code>&quot;Internode&quot;</code>) from the assimilation at the <code>&quot;Leaf&quot;</code> scale (<em>i.e.</em> the offer) and their carbon demand (<code>ToyCDemandModel</code>). The <code>&quot;Soil&quot;</code> scale is used to compute the soil water content (<code>ToySoilWaterModel</code>), which is needed to calculate the assimilation at the <code>&quot;Leaf&quot;</code> scale (<code>ToyAssimModel</code>). We also can note that we compute the maintenance respiration at the <code>&quot;Leaf&quot;</code> and <code>&quot;Internode&quot;</code> scales (<code>ToyMaintenanceRespirationModel</code>), which is summed up to compute the total maintenance respiration at the <code>&quot;Plant&quot;</code> scale (<code>ToyPlantRmModel</code>). </p><p>We see that all scales are interconnected, with computations at the organ scale that may depend on the soil scale and at the plant scale that depends on the organ scale and scene scale.</p><p>Something important to note here is that we have different ways to define the mapping for the <code>MultiScaleModel</code>. For example, we have <code>:carbon_assimilation =&gt; [&quot;Leaf&quot;]</code> at the plant scale for <code>ToyCAllocationModel</code>. This mapping means that the variable <code>carbon_assimilation</code> is mapped to the <code>&quot;Leaf&quot;</code> scale. However, we could also have <code>:carbon_assimilation =&gt; &quot;Leaf&quot;</code>, which is not completely equivalent.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Note the difference between <code>:carbon_assimilation =&gt; [&quot;Leaf&quot;]</code> and <code>:carbon_assimilation =&gt; &quot;Leaf&quot;</code> is that &quot;Leaf&quot; is given as a vector in the first definition, and as a scalar in the second one.</p></div></div><p>The difference is that the first one maps to a vector of values, while the second one maps to a single value. The first one is useful when we don&#39;t know how many nodes there will be in the plant of type <code>&quot;Leaf&quot;</code>. In this case, the values are available as a vector in the <code>carbon_assimilation</code> variable of the <code>status</code> inside the model. The second one should only be used if we are sure that there will be only one node at this scale, and in this case, the one and single value is given as a scalar in the <code>carbon_assimilation</code> variable of the <code>status</code> inside the model.</p><p>A third form for the mapping would be <code>:carbon_assimilation =&gt; [&quot;Leaf&quot;, &quot;Internode&quot;]</code>. This form is useful when we need values for a variable from several scales simultaneously. In this case, the values are available as a vector in the <code>carbon_assimilation</code> variable of the <code>status</code> inside the model, sorted in the same order as nodes are traversed in the graph.</p><p>A last form is to map to a specific variable name at the target scale, <em>e.g.</em> <code>:Rm_organs =&gt; [&quot;Leaf&quot; =&gt; :Rm, &quot;Internode&quot; =&gt; :Rm]</code>. This form is useful when the variable name is different between scales, and we want to map to a specific variable name at the target scale. In this example, the variable <code>Rm_organs</code> at plant scale takes its values (is mapped) from the variable <code>Rm</code> at the <code>&quot;Leaf&quot;</code> and <code>&quot;Internode&quot;</code> scales.</p><h2 id="Running-a-simulation"><a class="docs-heading-anchor" href="#Running-a-simulation">Running a simulation</a><a id="Running-a-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-simulation" title="Permalink"></a></h2><p>Now that we have a valid mapping, we can run a simulation. Running a multiscale simulation requires two more things compared to what we saw previously: a plant graph and the definition of the output variables we want dynamically for each scale.</p><h3 id="Plant-graph"><a class="docs-heading-anchor" href="#Plant-graph">Plant graph</a><a id="Plant-graph-1"></a><a class="docs-heading-anchor-permalink" href="#Plant-graph" title="Permalink"></a></h3><p>We can import an example multi-scale tree graph like so:</p><pre><code class="language-julia hljs">mtg = import_mtg_example()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">/ 1: Scene
├─ / 2: Soil
└─ + 3: Plant
   └─ / 4: Internode
      ├─ + 5: Leaf
      └─ &lt; 6: Internode
         └─ + 7: Leaf
</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>You can use <code>import_mtg_example</code> only if you previously imported the <code>Examples</code> sub-module of PlantSimEngine, <em>i.e.</em> <code>using PlantSimEngine.Examples</code>.</p></div></div><p>This graph has a root node that defines a scene, then a soil, and a plant with two internodes and two leaves.</p><h3 id="Output-variables"><a class="docs-heading-anchor" href="#Output-variables">Output variables</a><a id="Output-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Output-variables" title="Permalink"></a></h3><p>Models can access only one time step at a time, so the output at the end of a simulation is only the last time step. However, we can define a list of variables we want to get dynamically for each time step and each scale. This list is given as a dictionary with the name of the scale as the key and a vector of variables as the value. For example, we can define a list of variables we want to get at each time step for different scales as follows:</p><pre><code class="language-julia hljs">outs = Dict(
    &quot;Scene&quot; =&gt; (:TT, :TT_cu,),
    &quot;Plant&quot; =&gt; (:aPPFD, :LAI),
    &quot;Leaf&quot; =&gt; (:carbon_assimilation, :carbon_demand, :carbon_allocation, :TT),
    &quot;Internode&quot; =&gt; (:carbon_allocation,),
    &quot;Soil&quot; =&gt; (:soil_water_content,),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Tuple{Symbol, Vararg{Symbol}}} with 5 entries:
  &quot;Soil&quot;      =&gt; (:soil_water_content,)
  &quot;Internode&quot; =&gt; (:carbon_allocation,)
  &quot;Scene&quot;     =&gt; (:TT, :TT_cu)
  &quot;Plant&quot;     =&gt; (:aPPFD, :LAI)
  &quot;Leaf&quot;      =&gt; (:carbon_assimilation, :carbon_demand, :carbon_allocation, :TT)</code></pre><p>These variables will be available in the output returned by <code>run!</code>, with a value for each time step. </p><h3 id="Meteorological-data"><a class="docs-heading-anchor" href="#Meteorological-data">Meteorological data</a><a id="Meteorological-data-1"></a><a class="docs-heading-anchor-permalink" href="#Meteorological-data" title="Permalink"></a></h3><p>As for mono-scale models, we need to provide meteorological data to run a simulation. We can use the <code>PlantMeteo</code> package to generate some dummy data for two time steps:</p><pre><code class="language-julia hljs">meteo = Weather(
    [
    Atmosphere(T=20.0, Wind=1.0, Rh=0.65, Ri_PAR_f = 200.0),
    Atmosphere(T=25.0, Wind=0.5, Rh=0.8, Ri_PAR_f = 180.0)
]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TimeStepTable{Atmosphere{(:date, :duration,...}(2 x 22):
<span class="sgr31">╭─────┬─────────────────────────┬──────────────┬─────────┬─────────┬─────────┬──</span>
<span class="sgr31">│</span><span class="sgr1"> Row </span><span class="sgr31">│</span><span class="sgr1">                    date </span><span class="sgr31">│</span><span class="sgr1">     duration </span><span class="sgr31">│</span><span class="sgr1">       T </span><span class="sgr31">│</span><span class="sgr1">    Wind </span><span class="sgr31">│</span><span class="sgr1">       P </span><span class="sgr31">│</span> ⋯
<span class="sgr31">│</span>     <span class="sgr31">│</span><span class="sgr90">          Dates.DateTime </span><span class="sgr31">│</span><span class="sgr90"> Dates.Second </span><span class="sgr31">│</span><span class="sgr90"> Float64 </span><span class="sgr31">│</span><span class="sgr90"> Float64 </span><span class="sgr31">│</span><span class="sgr90"> Float64 </span><span class="sgr31">│</span> ⋯
<span class="sgr31">├─────┼─────────────────────────┼──────────────┼─────────┼─────────┼─────────┼──</span>
<span class="sgr31">│</span>   1 <span class="sgr31">│</span> 2025-02-28T16:22:01.345 <span class="sgr31">│</span>     1 second <span class="sgr31">│</span>    20.0 <span class="sgr31">│</span>     1.0 <span class="sgr31">│</span> 101.325 <span class="sgr31">│</span> ⋯
<span class="sgr31">│</span>   2 <span class="sgr31">│</span> 2025-02-28T16:22:01.345 <span class="sgr31">│</span>     1 second <span class="sgr31">│</span>    25.0 <span class="sgr31">│</span>     0.5 <span class="sgr31">│</span> 101.325 <span class="sgr31">│</span> ⋯
<span class="sgr31">╰─────┴─────────────────────────┴──────────────┴─────────┴─────────┴─────────┴──</span>
<span class="sgr36">                                                              17 columns omitted</span>
</code></pre><h3 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h3><p>Let&#39;s make a simulation using the graph and outputs we just defined:</p><pre><code class="language-julia hljs">outputs_sim = run!(mtg, mapping, meteo, tracked_outputs = outs);</code></pre><p>And that&#39;s it! We can now access the outputs for each scale as a dictionary of vectors of values per variable and scale.</p><p>Or as a <code>DataFrame</code> using the <code>DataFrames</code> package:</p><pre><code class="language-julia hljs">using DataFrames
convert_outputs(outputs_sim, DataFrame)</code></pre><div><div style = "float: left;"><span>14×11 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">timestep</th><th style = "text-align: left;">organ</th><th style = "text-align: left;">node</th><th style = "text-align: left;">carbon_allocation</th><th style = "text-align: left;">TT_cu</th><th style = "text-align: left;">carbon_assimilation</th><th style = "text-align: left;">TT</th><th style = "text-align: left;">aPPFD</th><th style = "text-align: left;">LAI</th><th style = "text-align: left;">soil_water_content</th><th style = "text-align: left;">carbon_demand</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th><th title = "Union{Nothing, Float64}" style = "text-align: left;">Union…</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Soil</td><td style = "text-align: right;">2</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Soil</td><td style = "text-align: right;">2</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">4</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">6</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">4</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Internode</td><td style = "text-align: right;">6</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Scene</td><td style = "text-align: right;">1</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Scene</td><td style = "text-align: right;">1</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">25.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">15.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Plant</td><td style = "text-align: right;">3</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">3.32692</td><td style = "text-align: left;">0.00607765</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Plant</td><td style = "text-align: right;">3</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">3.43038</td><td style = "text-align: left;">0.00696482</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">5</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.332692</td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">7</td><td style = "text-align: left;">0.166028</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.332692</td><td style = "text-align: left;">10.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">5</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.343038</td><td style = "text-align: left;">15.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.75</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Leaf</td><td style = "text-align: right;">7</td><td style = "text-align: left;">0.171072</td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.343038</td><td style = "text-align: left;">15.0</td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "font-style: italic; text-align: left;"></td><td style = "text-align: left;">0.75</td></tr></tbody></table></div><h3 id="Wrapping-up"><a class="docs-heading-anchor" href="#Wrapping-up">Wrapping up</a><a id="Wrapping-up-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapping-up" title="Permalink"></a></h3><p>In this section, we saw how to define a mapping between models and scales, run a simulation, and access the outputs.</p><p>This is just a simple example, but PlantSimEngine can be used to define and combine much more complex models at multiple scales of detail. With its modular architecture and intuitive API, PlantSimEngine is a powerful tool for multi-scale plant growth and development modeling.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../working_with_data/visualising_outputs/">« Visualizing outputs</a><a class="docs-footer-nextpage" href="../multiscale_cyclic/">Handling cyclic dependencies »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Friday 28 February 2025 16:22">Friday 28 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

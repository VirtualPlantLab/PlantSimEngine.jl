<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Visualizing our toy plant with PlantGeom · PlantSimEngine.jl</title><meta name="title" content="Visualizing our toy plant with PlantGeom · PlantSimEngine.jl"/><meta property="og:title" content="Visualizing our toy plant with PlantGeom · PlantSimEngine.jl"/><meta property="twitter:title" content="Visualizing our toy plant with PlantGeom · PlantSimEngine.jl"/><meta name="description" content="Documentation for PlantSimEngine.jl."/><meta property="og:description" content="Documentation for PlantSimEngine.jl."/><meta property="twitter:description" content="Documentation for PlantSimEngine.jl."/><meta property="og:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale_example_4/"/><meta property="twitter:url" content="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale_example_4/"/><link rel="canonical" href="https://VirtualPlantLab.github.io/PlantSimEngine.jl/multiscale/multiscale_example_4/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../introduction/why_plantsimengine/">Why PlantSimEngine ?</a></li><li><a class="tocitem" href="../../introduction/why_julia/">Why Julia ?</a></li></ul></li><li><span class="tocitem">Prerequisites</span><ul><li><a class="tocitem" href="../../prerequisites/installing_plantsimengine/">Installing and running PlantSimEngine</a></li><li><a class="tocitem" href="../../prerequisites/key_concepts/">Key Concepts</a></li><li><a class="tocitem" href="../../prerequisites/julia_basics/">Julia language basics</a></li></ul></li><li><span class="tocitem">Step by step - Single-scale simulations</span><ul><li><a class="tocitem" href="../../step_by_step/detailed_first_example/">Detailed first simulation</a></li><li><a class="tocitem" href="../../step_by_step/simple_model_coupling/">Coupling</a></li><li><a class="tocitem" href="../../step_by_step/model_switching/">Model Switching</a></li><li><a class="tocitem" href="../../step_by_step/quick_and_dirty_examples/">Quick examples</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_process/">Implementing a process</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model/">Implementing a model</a></li><li><a class="tocitem" href="../../step_by_step/parallelization/">Parallelization</a></li><li><a class="tocitem" href="../../step_by_step/advanced_coupling/">Advanced coupling and hard dependencies</a></li><li><a class="tocitem" href="../../step_by_step/implement_a_model_additional/">Implementing a model : additional notes</a></li></ul></li><li><a class="tocitem" href="../../model_execution/">Execution</a></li><li><span class="tocitem">Working with data</span><ul><li><a class="tocitem" href="../../working_with_data/reducing_dof/">Reducing DoF</a></li><li><a class="tocitem" href="../../working_with_data/fitting/">Fitting</a></li><li><a class="tocitem" href="../../working_with_data/inputs/">Input types</a></li><li><a class="tocitem" href="../../working_with_data/visualising_outputs/">Visualizing outputs and data</a></li><li><a class="tocitem" href="../../working_with_data/floating_point_accumulation_error/">Floating-point considerations</a></li></ul></li><li><span class="tocitem">Moving to multiscale</span><ul><li><a class="tocitem" href="../multiscale_considerations/">Multiscale considerations</a></li><li><a class="tocitem" href="../single_to_multiscale/">Converting a simulation to multi-scale</a></li><li><a class="tocitem" href="../multiscale/">More variable mapping examples</a></li><li><a class="tocitem" href="../multiscale_cyclic/">Handling cyclic dependencies</a></li><li><a class="tocitem" href="../multiscale_coupling/">Multiscale coupling considerations</a></li><li><input class="collapse-toggle" id="menuitem-7-6" type="checkbox"/><label class="tocitem" for="menuitem-7-6"><span class="docs-label">Building a simple plant</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../multiscale_example_1/">A rudimentary plant simulation</a></li><li><a class="tocitem" href="../multiscale_example_2/">Expanding the plant simulation</a></li><li><a class="tocitem" href="../multiscale_example_3/">Fixing bugs in the plant simulation</a></li></ul></li><li class="is-active"><a class="tocitem" href>Visualizing our toy plant with PlantGeom</a></li></ul></li><li><span class="tocitem">Troubleshooting and testing</span><ul><li><a class="tocitem" href="../../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/downstream_tests/">Automated testing</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/tips_and_workarounds/">Tips and Workarounds</a></li><li><a class="tocitem" href="../../troubleshooting_and_testing/implicit_contracts/">Implicit contracts</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../API/API_public/">Public API</a></li><li><a class="tocitem" href="../../API/API_examples/">Example models</a></li><li><a class="tocitem" href="../../API/API_private/">Internal API</a></li></ul></li><li><a class="tocitem" href="../../documentation_improvement/">Improving our documentation</a></li><li><a class="tocitem" href="../../developers/">Developer guidelines</a></li><li><a class="tocitem" href="../../planned_features/">Planned features</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Moving to multiscale</a></li><li class="is-active"><a href>Visualizing our toy plant with PlantGeom</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Visualizing our toy plant with PlantGeom</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/PlantSimEngine.jl/blob/main/docs/src/multiscale/multiscale_example_4.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Visualizing-a-plant-using-PlantGeom"><a class="docs-heading-anchor" href="#Visualizing-a-plant-using-PlantGeom">Visualizing a plant using PlantGeom</a><a id="Visualizing-a-plant-using-PlantGeom-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-a-plant-using-PlantGeom" title="Permalink"></a></h1><p>We&#39;ve created our toy plant, part of the fun is to actually visualize it !</p><p>Let&#39;s see how to do so with the <a href="https://github.com/VEZY/PlantGeom.jl">PlantGeom</a> companion package.</p><p>We&#39;ll be reusing the mtg from part 3 of the plant tutorial: <a href="../multiscale_example_3/#Fixing-bugs-in-the-plant-simulation">Fixing bugs in the plant simulation</a>, so you need to run that simulation first, or to include the script file into your current code (which is what we&#39;ll do here):</p><pre><code class="language-julia hljs">using PlantSimEngine
using MultiScaleTreeGraph
using PlantSimEngine.Examples
using Pkg
Pkg.add(&quot;CSV&quot;)
using CSV
include(&quot;ToyPlantSimulation3.jl&quot;)</code></pre><p>You&#39;ll need to add PlantGeom and a compatible visualization package to your environment. We&#39;ll use Plots:</p><pre><code class="language-julia hljs">using Plots
using PlantGeom</code></pre><p>That&#39;s enough to get a nicer display of the MTG than the console-based printing. You&#39;ll only need to type the following line:</p><pre><code class="language-julia hljs">RecipesBase.plot(mtg)</code></pre><p>This provides the following visualization: <img src="../../www/mtg_plot_1.svg" alt="MTG Plots visualization"/></p><p>And that&#39;s it !</p><p>We can see the root expansion in one direction, and the internodes with their leaves in the other.</p><p>Of course, that&#39;s good and all, but going beyond that would be nice. </p><p>PlantGeom is able to render geometry from what it finds in the MTG. If a node in the tree graph has a <code>:geometry</code> attribute with a mesh and a transformation, it can make use of that to build a plant. That mesh can be unique per node, or based on a reference mesh that is copied and transformed for every node.</p><div class="admonition is-info" id="Note-8792622864fd2cc4"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-8792622864fd2cc4" title="Permalink"></a></header><div class="admonition-body"><p>This page simply aims to illustrate PlantGeom&#39;s features and doesn&#39;t aim for a particularly realistic or aesthetic look. A little randomness could go a long way to make the plant look a little more life-like, but would also be very ad-hoc and make the code less clear.</p></div></div><p>Our MTG doesn&#39;t have any such attribute, so we&#39;ll need to iterate on our nodes, provide them with a mesh and calculate appropriate transformations. We&#39;ll use one reference mesh for each plant-related scale, Internode, Root and Leaf. </p><p>We&#39;ll make use of some of the Meshes primitives and transformations, as well as some helper functions from the packages TransformsBase and Rotations. For leaves, we&#39;ll read a .ply file using the PlyIO package, which contains a very unrealistic leaf + petiole mesh.</p><p>We&#39;ll also make our plant opposite decussate: leaves come in pairs, and pairs are rotated by 90 degrees along the stem.</p><p>The function that&#39;ll provide the geometry to the node is:</p><pre><code class="language-julia hljs">PlantGeom.Geometry(; ref_mesh&lt;:RefMesh, transformation=Identity(), dUp=1.0, dDwn=1.0, mesh::Union{SimpleMesh,Nothing}=nothing)</code></pre><p>We only care about the first two parameters in our case, and we can use a simple cylinder for each node of our single Internode stem and single Root.</p><pre><code class="language-julia hljs">using PlantGeom.Meshes

# Internodes and roots will use a cylinder as a mesh

cylinder() = Meshes.CylinderSurface(1.0) |&gt; Meshes.discretize |&gt; Meshes.simplexify

refmesh_internode = PlantGeom.RefMesh(&quot;Internode&quot;, cylinder())
refmesh_root = PlantGeom.RefMesh(&quot;Root&quot;, cylinder())</code></pre><p>A simple function to read the vertices and faces from the .ply file for our leaves:</p><pre><code class="language-julia hljs">Pkg.add(&quot;PlyIO&quot;)
using PlyIO
function read_ply(fname)
    ply = PlyIO.load_ply(fname)
    x = ply[&quot;vertex&quot;][&quot;x&quot;]
    y = ply[&quot;vertex&quot;][&quot;y&quot;]
    z = ply[&quot;vertex&quot;][&quot;z&quot;]  
    points = Meshes.Point.(x, y, z)
    connec = [Meshes.connect(Tuple(c .+ 1)) for c in ply[&quot;face&quot;][&quot;vertex_indices&quot;]]
    Meshes.SimpleMesh(points, connec)
end

leaf_ply = read_ply(&quot;examples/leaf_with_petiole.ply&quot;)
refmesh_leaf = PlantGeom.RefMesh(&quot;Leaf&quot;, leaf_ply)</code></pre><pre><code class="language-julia hljs">Pkg.add(&quot;TransformsBase&quot;)
Pkg.add(&quot;Rotations&quot;)
import TransformsBase: →
import Rotations: RotY, RotZ, RotX</code></pre><div class="admonition is-info" id="Note-363443a70b8c409e"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-363443a70b8c409e" title="Permalink"></a></header><div class="admonition-body"><p>We&#39;ll use X, Y, Z as standard cartersian coordinate axes, with Z pointing upwards. </p></div></div><p>We can then write the function that adds the geometry to our MTG.</p><p>It traverses the MTG, starting from the base, and adds a transformation for each encountered node.</p><p>The following just operates on internodes, for clarity:</p><pre><code class="language-julia hljs"># Add the geometry to the MTG, with transformations
function add_geometry!(mtg, refmesh_internode) 
    
    # incremental offset
    internode_height = 0.0

    # relative scale of the base mesh
    internode_width = 0.5

    # length of the base mesh
    internode_length = 1.0

    traverse!(mtg) do node
        if symbol(node) == &quot;Internode&quot;
            # Set to scale, then translate by the total height
            mesh_transformation = Meshes.Scale(internode_width, internode_width, internode_length) → Meshes.Translate(0.0, 0.0, internode_height)
            node.geometry = PlantGeom.Geometry(ref_mesh=refmesh_internode, transformation=mesh_transformation)
            
            internode_height += node_length
        end
    end
end</code></pre><p>We simply need to choose a given width for our stem, and increment the height to place our next internode at as we traverse it. </p><p>Note that the default cylinder provided by Meshes.jl points upwards, which is why there is no need for rotation. Roots function likewise, but are simply translated down, and need to start below the origin.</p><p>We can visualize this simple stem, using GLMakie as a rendering backend:</p><pre><code class="language-julia hljs">add_geometry!(mtg, refmesh_internode)

# Visualize the mesh
using GLMakie
viz(mtg)</code></pre><p><img src="../../www/toy_plant_stem_only.png" alt="Toy Plant - stem only"/></p><p>On the other hand, the leaf mesh will need to be rotated, but it is aligned along the X axis, so there is no need for an initial reorientation (which would have been required if it was pointing upwards like the cylinders). The petiole starts at the origin, so on top of translating them to leaf height we also need to translate them away from the Z axis by the internode radius. The mesh also needs to be scaled, as it is only 0.1 unit lengths long compared to our 0.5-width internode.</p><p>Let&#39;s also rotate our leaves so that they point upwards slightly.</p><p>If you make use of other meshes, bear in mind the initial starting translation, orientation and scale. You may need to test and calibrate scales and transformations before you get it right.</p><p>The full code that generates geometry for all the organs of our toy plant is the following:</p><pre><code class="language-julia hljs"># Add the geometry to the MTG, with transformations
function add_geometry!(mtg, refmesh_internode, refmesh_root, refmesh_leaf) 
    
    # incremental offset
    internode_height = 0.0
    root_depth = 0.0

    # relative scale of the base mesh (base cylinder is of height 1 and radius 1)
    internode_width = 0.5
    root_width = 0.2

    # length of the base mesh
    internode_length = 1.0
    root_length = 1.0

    # ad hoc value to adjust the leaf mesh to the scene scale
    leaf_mesh_scale = 25

    leaf_scale_width = 0.4*leaf_mesh_scale
    leaf_scale_height = 0.4*leaf_mesh_scale
    
    # Helpers to make the leaves opposite decussate
    leaf_rotation = MathConstants.pi / 2.0
    i = 0

    traverse!(mtg) do node
        if symbol(node) == &quot;Internode&quot;
            # Set to scale, then translate by the total height
            mesh_transformation = Meshes.Scale(internode_width, internode_width, internode_length) → Meshes.Translate(0.0, 0.0, internode_height)
            node.geometry = PlantGeom.Geometry(ref_mesh=refmesh_internode, transformation=mesh_transformation)
            
            internode_height += internode_length

            # Leaves are placed relatively to the parent internode, halfway along it
            for chnode in children(node)               
                if symbol(chnode) == &quot;Leaf&quot; 
                    mesh_transformation = Meshes.Scale(leaf_scale_width, leaf_scale_width, leaf_scale_height) → Meshes.Rotate(RotX(-MathConstants.pi / 6.0)) → Meshes.Translate(0.0, -internode_width, internode_height - internode_length / 2.0) → Meshes.Rotate(RotZ(leaf_rotation))
                    chnode.geometry = PlantGeom.Geometry(ref_mesh=refmesh_leaf, transformation=mesh_transformation)
                    # Set the second leaf in a pair opposite to the first one =&gt; add a 180° rotation
                    leaf_rotation += MathConstants.pi
                end                
            end

            # Opposite decussate =&gt; 90° rotation between pairs
            i += 1
            if i % 2 == 0
                leaf_rotation = MathConstants.pi / 2.0
            else
                leaf_rotation = MathConstants.pi
            end

        elseif symbol(node) == &quot;Root&quot;
            mesh_transformation = Meshes.Scale(root_width, root_width, root_length) → Meshes.Translate(0.0, 0.0, root_depth) → Meshes.Rotate(RotZ(MathConstants.pi))
            node.geometry = PlantGeom.Geometry(ref_mesh=refmesh_root, transformation=mesh_transformation)
            root_depth -= root_length
        end
    end
end</code></pre><p>And now, let&#39;s visualize our fully-grown, fully-featured plant:</p><pre><code class="language-julia hljs"># Visualize the mesh
using GLMakie
viz(mtg)    </code></pre><p>Which gives us the following image scene:</p><p><img src="../../www/toy_plant.png" alt="Toy Plant with root and leaves"/></p><p>Feel free to try and make this plant prettier, more colourful, or more physically realistic, using more realistic models on the PlantSimEngine side, or better geometry on the Plantgeom end.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../multiscale_example_3/">« Fixing bugs in the plant simulation</a><a class="docs-footer-nextpage" href="../../troubleshooting_and_testing/plantsimengine_and_julia_troubleshooting/">Troubleshooting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 23 September 2025 15:37">Tuesday 23 September 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

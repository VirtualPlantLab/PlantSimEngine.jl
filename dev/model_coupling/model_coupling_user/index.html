<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Users · PlantSimEngine.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://VEZY.github.io/PlantSimEngine.jl/model_coupling/model_coupling_user/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantSimEngine.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../design/">Design</a></li><li><span class="tocitem">Extending</span><ul><li><a class="tocitem" href="../../extending/implement_a_process/">Processes</a></li><li><a class="tocitem" href="../../extending/implement_a_model/">Models</a></li></ul></li><li><span class="tocitem">Coupling</span><ul><li class="is-active"><a class="tocitem" href>Users</a></li><li><a class="tocitem" href="../model_coupling_modeler/">Modelers</a></li></ul></li><li><a class="tocitem" href="../../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Coupling</a></li><li class="is-active"><a href>Users</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Users</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/VEZY/PlantSimEngine.jl/blob/main/docs/src/model_coupling/model_coupling_user.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-coupling-for-users"><a class="docs-heading-anchor" href="#Model-coupling-for-users">Model coupling for users</a><a id="Model-coupling-for-users-1"></a><a class="docs-heading-anchor-permalink" href="#Model-coupling-for-users" title="Permalink"></a></h1><p><code>PlantSimEngine.jl</code> is designed to make model coupling simple for both the modeler and the user. For example, <code>PlantBiophysics.jl</code> implements the <a href="https://vezy.github.io/PlantBiophysics.jl/stable/functions/#PlantBiophysics.Fvcb"><code>Fvcb</code></a> model to simulate the photosynthesis process. This model needs the stomatal conductance process to be simulated, so it calls the <code>stomatal_conductance_</code> function at some point. Note that it does not force any model for its computation, just the process. This ensures that users can choose whichever model they want to use for this simulation, independent of the photosynthesis model.</p><p>We provide an example script that implements three dummy processes in <a href="https://github.com/VEZY/PlantSimEngine.jl/blob/main/examples/dummy.jl"><code>examples/dummy</code></a>. We also provide an example model implementation for each, that makes a sequential coupling, meaning that the third model uses the second one, which uses the first one.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Model coupling is usually done when there are some kind of iterative computation in one of the models that depend on one another. This is not the case in our example here as it is obviously just a simple one. In this case the coupling is not really necessary as models could just be called sequentially one after the other. For a more representative example, you can look at the energy balance computation of Monteith in <code>PlantBiophysics.jl</code>, which is coupled to a photosynthesis model.</p></div></div><p>Back to our example, we have three processes called &quot;process1&quot;, &quot;process2&quot; and &quot;process3&quot;. Then we have one model implementation for each, called <code>Process1Model</code>, <code>Process2Model</code> and <code>Process3Model</code>. So in practice, using <code>Process3Model</code> requires a &quot;process2&quot; model, and in our case the only model available is <code>Process2Model</code>. The latter also requires a &quot;process1&quot; model, and again we only have one model implementation for this process, which is <code>Process1Model</code>. </p><p>Let&#39;s include this script so we can play around:</p><pre><code class="language-julia hljs">include(joinpath(dirname(dirname(pathof(PlantSimEngine))), &quot;examples&quot;, &quot;dummy.jl&quot;))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">process7!_ (generic function with 7 methods)</code></pre><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Use subtype(x) to know which models are available for a process, e.g. for &quot;process1&quot; you can do <code>subtypes(AbstractProcess1Model)</code>.</p></div></div><p>Here is how we can make the models coupling:</p><pre><code class="language- hljs">m = ModelList(
    process1 = Process1Model(2.0), 
    process2 = Process2Model(),
    process3 = Process3Model()
)</code></pre><p>We can see that only the first model has a parameter. You can usually know that by looking at the help of the structure (<em>e.g.</em> <code>?Process1Model</code>), else, you can still look at the field names of the structure like so <code>fieldnames(Process1Model)</code>.</p><p>Note that the user only declares the models, not the way the models are coupled, because <code>PlantSimEngine.jl</code> deals with that automatically.</p><p>Now the example above returns some warnings saying we need to initialize some variables: <code>var1</code> and <code>var2</code>. <code>PlantSimEngine.jl</code> automatically computes which variables should be initialized based on the inputs and outputs of all models, considering their coupling.</p><p>For example <code>Process1Model</code> requires the following variables as inputs:</p><pre><code class="language-julia hljs">inputs(Process1Model(2.0))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:var1, :var2)</code></pre><p>And the <code>Process2Model</code> model requires the following variables:</p><pre><code class="language-julia hljs">inputs(Process2Model())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:var1, :var3)</code></pre><p>We see that <code>var1</code> is needed as inputs of both models, but we also see that <code>var3</code> is an output of <code>Process2Model</code>:</p><pre><code class="language-julia hljs">outputs(Process2Model())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(:var4, :var5)</code></pre><p>So considering those two models, we only need <code>var1</code> and <code>var2</code> to be initialized as <code>var3</code> is computed. This is why we recommend <a href="../../API/#PlantSimEngine.to_initialize-Tuple{ModelList}"><code>to_initialize</code></a> instead of <a href="../../API/#PlantSimEngine.inputs-Tuple{T} where T&lt;:AbstractModel"><code>inputs</code></a>, because it returns only the variables that need to be initialized, considering that some inputs are duplicated between models, and some are computed by other models (they are outputs of a model):</p><pre><code class="language- hljs">m = ModelList(
    process1 = Process1Model(2.0), 
    process2 = Process2Model(),
    process3 = Process3Model(),
    variables_check=false # Just so we don&#39;t have the warning printed out
)

to_initialize(m)</code></pre><p>The most straightforward way of initializing a model list is by giving the initializations to the <code>status</code> keyword argument during instantiation:</p><pre><code class="language- hljs">m = ModelList(
    process1 = Process1Model(2.0), 
    process2 = Process2Model(),
    process3 = Process3Model(),
    status = (var1=15.0, var2=0.3)
)</code></pre><p>Our component models structure is now fully parameterized and initialized for a simulation!</p><p>Let&#39;s simulate it:</p><pre><code class="language- hljs">using PlantMeteo
meteo = Atmosphere(T = 22.0, Wind = 0.8333, P = 101.325, Rh = 0.4490995)

process3(m, meteo)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../extending/implement_a_model/">« Models</a><a class="docs-footer-nextpage" href="../model_coupling_modeler/">Modelers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 19 January 2023 17:12">Thursday 19 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
